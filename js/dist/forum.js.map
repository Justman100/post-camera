{"version":3,"file":"forum.js","mappings":"MACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,CAAM,ECLdF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDR,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFf,EAAyBM,IACH,oBAAXa,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeL,EAASa,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeL,EAAS,aAAc,CAAEe,OAAO,GAAO,G,+BCL9D,MAAM,EAA+BC,OAAOC,KAAKC,OAAO,a,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,iBCAlD,EAA+BF,OAAOC,KAAKC,OAAO,kC,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,4B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,4B,aCSxD,MAAMC,EAAK,IAAIC,WAAW,GACpBC,EAAK,IAAID,WAAW,GACpBE,EAAK,IAAIF,WAAW,GACpBG,EAAK,IAAIH,WAAW,GAC1B,IAAII,EA8BJ,SAASC,EAAaC,EAAYC,EAAKC,GAAgB,GACrD,MAAMC,EAAY,IAAIC,WAAW,IACjCH,GAAO,QACPE,EAAU,GAAKV,EACfU,EAAU,GAAKR,EACfQ,EAAU,GAAKP,EACfO,EAAU,GAAKN,EACfM,EAAU,GAAKF,IAAQ,GACvBE,EAAU,GAAKF,IAAQ,GACvBE,EAAU,GAAKF,IAAQ,EACvBE,EAAU,GAAW,IAANF,EACfE,EAAU,GAAKA,EAAU,GACzBA,EAAU,GAAKA,EAAU,GACzBA,EAAU,IAAMA,EAAU,GAC1BA,EAAU,IAAMA,EAAU,GAC1BA,EAAU,IAAM,EAChB,MAAME,EAlCR,SAAiBL,GACf,IAAIM,GAAK,EACJR,IACHA,EAdJ,WACE,MAAMS,EAAW,IAAIC,WAAW,KAChC,IAAK,IAAIC,EAAI,EAAGA,EAAI,IAAKA,IAAK,CAC5B,IAAIH,EAAIG,EACR,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAGA,IACrBJ,EAAQ,EAAJA,EAAQ,WAAaA,IAAM,EAAIA,IAAM,EAE3CC,EAASE,GAAKH,CAChB,CACA,OAAOC,CACT,CAImBI,IACjB,IAAK,IAAIF,EAAI,EAAGA,EAAIT,EAAWY,OAAQH,IACrCH,EAAIR,EAAmC,KAArBQ,EAAIN,EAAWS,KAAaH,IAAM,EAEtD,OAAY,EAALA,CACT,CA0BcO,CAAQV,GACdW,EAAW,IAAIV,WAAW,GAKhC,GAJAU,EAAS,GAAKT,IAAQ,GACtBS,EAAS,GAAKT,IAAQ,GACtBS,EAAS,GAAKT,IAAQ,EACtBS,EAAS,GAAW,IAANT,EACVH,EAAe,CACjB,MAAMa,EAhCV,SAA2Bf,GAEzB,IAAK,IAAIgB,EADMhB,EAAWY,OAAS,EACdI,GAAK,EAAGA,IAC3B,GAA0B,IAAtBhB,EAAWgB,EAAI,IAAYhB,EAAWgB,EAAI,KAAOvB,GAAMO,EAAWgB,EAAI,KAAOrB,GAAMK,EAAWgB,EAAI,KAAOpB,GAAMI,EAAWgB,KAAOnB,EACnI,OAAOmB,EAAI,EAGf,OAAO,CACT,CAwB0BC,CAAkBjB,GAGxC,OAFAA,EAAWkB,IAAIf,EAAWY,GAC1Bf,EAAWkB,IAAIJ,EAAUC,EAAgB,IAClCf,CACT,CAAO,CACL,MAAMmB,EAAc,IAAIf,WAAW,GACnCe,EAAY,GAAK,EACjBA,EAAY,GAAK,EACjBA,EAAY,GAAK,EACjBA,EAAY,GAAK,EACjB,MAAMC,EAAc,IAAIhB,WAAW,IAKnC,OAJAgB,EAAYF,IAAIlB,EAAY,GAC5BoB,EAAYF,IAAIC,EAAa,IAC7BC,EAAYF,IAAIf,EAAW,IAC3BiB,EAAYF,IAAIJ,EAAU,IACnBM,CACT,CACF,CACA,MAAMC,EAAoB,WACpBC,EAAoB,WACpBC,EAAoB,WAYpBC,EAAS,sBACTC,EAA+B,oBAAXC,OACpBC,EAAqBF,GAAc,WAAYC,OAC/CE,EAAeH,GAAc,SAAUC,OACvCG,EAAeJ,GAAc,SAAUC,OACvCI,EAAaL,EAAaC,OAAOK,WAAWC,UAAY,GACxDC,EAAYH,EAAWI,SAAS,UAChCC,EAAYL,EAAWI,SAAS,iBAAmBD,EACnDG,EAAaN,EAAWI,SAAS,WACjCG,EAAahD,GAAUA,GAAS,gBAAiBA,EACjDiD,EAAqBC,GAAmC,oBAA1BA,EAAKC,YAAYC,KAC/CC,EAAmBH,GAAmC,kBAA1BA,EAAKC,YAAYC,KAC7CE,EAAiBC,GAA2B,IAAlBA,EAAKC,SAC/BC,EAAoBF,GAAmC,iBAAnBA,EAAKG,UACzCC,EAAyBJ,GAA0B,UAAjBA,EAAKK,QACvCC,EAAuBN,GAA0B,QAAjBA,EAAKK,QACrCE,EAAqBP,GAASD,EAAcC,SAA+B,IAAfA,EAAKQ,QAA0BN,EAAiBF,GAC5GS,EAAiBT,GAA2B,IAAlBA,EAAKC,SAC/BS,EAAcV,GAA2B,IAAlBA,EAAKC,SAC5BU,EAAkBX,GAA0B,QAAjBA,EAAKK,QAChCO,EAAkBZ,GAA0B,UAAjBA,EAAKK,QAChCQ,EAAmBb,GAA0B,WAAjBA,EAAKK,QACjCS,EAAqBd,GAA0B,aAAjBA,EAAKK,QACnCU,EAAkBf,GAA0B,UAAjBA,EAAKK,QAChCW,EAAkBhB,GAA0B,UAAjBA,EAAKK,QAChCY,EAAmBjB,GAA0B,WAAjBA,EAAKK,QACjCa,EAAmBlB,GAA0B,WAAjBA,EAAKK,QACjCc,EAAiBnB,GAA0B,SAAjBA,EAAKK,QAC/Be,EAAmBpB,GAA0B,WAAjBA,EAAKK,QACjCgB,EAAc,IAAIC,IAASC,QAAQC,KAAK5C,KAAW0C,GACzD,SAASG,EAAYC,GACnB,MAAMC,EAASD,GAAeE,gBAAgB,UAI9C,OAHID,IACFA,EAAOE,OAASF,EAAOG,MAAQ,GAE1BC,QAAQJ,IAAW,cAAeA,GAAUI,QAAQJ,EAAOK,UAAU,cAAc1C,SAAS,cACrG,CACA,MAAM2C,EAAaC,GAAQA,EAAIC,WAAW,SAC1C,SAASC,EAAWF,EAAKG,GACvB,GAAIH,EAAII,MAAM,iBACZ,OAAOJ,EACT,GAAIrD,GAAcqD,EAAII,MAAM,SAC1B,OAAOxD,OAAOyD,SAASC,SAAWN,EACpC,GAAIA,EAAII,MAAM,aACZ,OAAOJ,EACT,IAAKrD,EACH,OAAOqD,EACT,MAAMO,EAAMC,KAAcC,eAAeC,qBACnCC,EAAOJ,EAAIb,cAAc,QACzBnG,EAAIgH,EAAIb,cAAc,KAM5B,OALAa,EAAIK,KAAKC,YAAYF,GACrBJ,EAAIO,KAAKD,YAAYtH,GACjB4G,IACFQ,EAAKI,KAAOZ,GACd5G,EAAEwH,KAAOf,EACFzG,EAAEwH,IACX,CACA,SAASP,GAAYQ,GACnB,OAAQA,GAAUnD,EAAcmD,GAAUA,GAAQxB,cAAgBwB,IAAWpE,OAAOqE,QACtF,CACA,MAAMC,GAAQ,6BAyDd,MAAMC,GAAiBC,GAbvB,SAAkBA,EAAMC,GACtB,OAAO,IAAIC,SAAQ,CAACC,EAASC,KAC3B,MAAMC,EAAS,IAAIC,WACnBD,EAAOE,OAAS,IAAMJ,EAAQE,EAAOG,QACrCH,EAAOI,QAAU,IAAML,EAAOC,EAAOK,OACrCL,EAAOM,QAAU,IAAMP,EAAO,IAAIQ,MAAM,uBAAuBX,MAClD,YAATA,EACFI,EAAOQ,cAAcb,GACH,gBAATC,GACTI,EAAOS,kBAAkBd,EAC3B,GAEJ,CACgCe,CAASf,EAAM,WAE/C,SAASgB,GAAYpC,EAAKR,GACxB,MAAM6C,EAAM7B,GAAYhB,GAAeE,cAAc,OAIrD,OAHA2C,EAAIC,SAAW,OACfD,EAAIE,QAAU,QACdF,EAAIG,IAAMxC,EACHqC,CACT,CACA,SAASI,GAAUC,EAAOC,GACxB,OAAO,IAAIrB,SAASC,IAClB,MAAM,QAAEqB,EAAO,cAAEpD,EAAeqD,QAASC,EAAW,OAAEC,GAAWJ,GAAW,CAAC,EACvE7E,EAAwB,iBAAV4E,EAAqBN,GAAYM,EAAOlC,GAAYhB,IAAkBkD,EAC1F,IAAIM,EAAQ,KACRC,EAAuB,KAC3B,SAASC,IACP3B,EAAQzD,GACRkF,GAASG,aAAaH,GACtBC,KACF,CAIA,GAHIL,IACFI,EAAQI,WAAWF,EAAWN,IAE5BlE,EAAeZ,GAAO,CACxB,MAAMuF,EAAavF,EAAKuF,YAAcvF,EAAK0E,IAC3C,IAAKa,EACH,OAAIvF,EAAKwF,OACAb,GAAU3E,EAAKwF,OAAQX,GAASY,KAAKhC,GAEvC2B,IAET,GAAIpF,EAAK0F,YAAc,EACrB,OAAON,IAET,MAAMO,EAAeP,EACfL,EAAWf,IACfiB,IACE,oBACAM,EACAvB,GAEFgB,IAAchB,GACdoB,GAAW,EAEbD,EAAuB,KACrBnF,EAAK4F,oBAAoB,aAAcD,GACvC3F,EAAK4F,oBAAoB,QAASb,EAAQ,EAE5C/E,EAAK6F,iBAAiB,aAAcF,EAAc,CAAEG,MAAM,IAC1D9F,EAAK6F,iBAAiB,QAASd,EAAS,CAAEe,MAAM,GAClD,KAAO,CACL,MAAMP,EAAanF,EAAsBJ,GAAQA,EAAKiD,KAAK8C,QAAU/F,EAAKuF,YAAcvF,EAAK0E,IAC7F,IAAKa,EACH,OAAOH,IAET,MAAMY,EAASC,UACb,GAAItF,EAAeX,IAAS,WAAYA,EACtC,UACQA,EAAKkG,QACb,CAAE,MAAOlC,GACPiB,IACE,kDACAjF,EAAKmG,QAAQC,aAAeb,EAC5BvB,EAEJ,CAEFoB,GAAW,EAEPL,EAAWf,IACfiB,IACE,oBACAjF,EAAKmG,QAAQC,aAAeb,EAC5BvB,GAEFoB,GAAW,EAEb,GAAIzE,EAAeX,IAASA,EAAKqG,SAC/B,OAAOL,IAETb,EAAuB,KACrBnF,EAAK4F,oBAAoB,OAAQI,GACjChG,EAAK4F,oBAAoB,QAASb,EAAQ,EAE5C/E,EAAK6F,iBAAiB,OAAQG,EAAQ,CAAEF,MAAM,IAC9C9F,EAAK6F,iBAAiB,QAASd,EAAS,CAAEe,MAAM,GAClD,IAEJ,CAcA,MAAMQ,GAAuB,WAC3B,IAAIC,EAAU,EAEd,MAAO,KACLA,GAAW,EACJ,IAHY,QAAQC,KAAKC,SAAW,IAAM,GAAK,GAAGC,SAAS,MAAMC,OAAO,KAGzDJ,IAE1B,CAP6B,GAQ7B,SAASK,GAAgBC,GACvB,OAAOA,GAAYC,MAAM,KAAKC,KAAKC,GAAQA,EAAIC,OAAOC,QAAQ,OAAQ,IAAIC,gBAAeC,OAAOrF,QAClG,CAEA,SAASsF,GAAaC,GACpB,MAAO,CAELC,KAAOC,GAAUF,GAAS/F,QAAQgG,KAAK,GAAG3I,KAAU4I,KAEpDC,QAAUD,GAAUF,GAAS/F,QAAQkG,QAAQ,GAAG7I,KAAU4I,KAC1DhG,KAAM,IAAIF,IAASgG,GAASjG,KAAeC,GAE/C,CAQA2E,eAAeyB,GAAgB1H,EAAM6E,GACnC,OAAOpF,EAAUO,GAAQA,EAE3BiG,eAA6BjG,EAAM6E,GACjC,MAAM,MAAE8C,EAAQ,EAAC,UAAEC,EAAS,aAAEC,EAAe,GAAMhD,GAAW,CAAC,EACzDyC,EAAQvF,QAAQ8C,GAASyC,OACzBQ,EAAWjD,GAASiD,WAAY,EAChCpG,EAAgB1B,EAAK0B,gBAAkB7C,EAAaC,OAAOqE,cAAW,GACtE4E,EAAc/H,EAAK0B,eAAesG,cAAgBnJ,EAAaC,YAAS,GACxEmJ,EAA2B,IAAIC,IAC/BC,EAAU,CAEdrG,MAAO,EACPD,OAAQ,EACRuG,QAAS,EACT7E,KAAM,YACNoE,QACAU,gBAAiB,KACjB7H,MAAO,KACP4G,OAAQ,KACRkB,kBAAmB,EACnBxD,QAAS,IACTyD,SAAU,KACVjB,QACAkB,MAAO,CACLC,aA/ByBC,EA+BU7D,GAAS2D,OAAOE,eA9BhD,CACLC,MAAOD,EAAiB,WAAa,gBA8BnCE,iBAAkB,iFAClBF,gBAAgB,KACb7D,GAAS2D,OAEdK,QAAS,KACTC,KAAM,CAAC,EACPC,kBAAmB,IACnBnB,UAAW,KACXC,eACAmB,YAAa,KACbC,YAAa,KACbC,yBAA0B,KAC1BC,uBAAwB,KACxBC,cAAc,KACXvE,EAEHwE,aAAa,EACbC,IAAKjC,GAAaC,GAClBtH,OACA0B,gBACAqG,cACA1K,IAAe,IAAVsK,EAAc,KAAO,GAAKA,EAC/B4B,gBAAiBC,GAAmB9H,GACpC+H,eAAgB/H,GAAegI,gBAAgBtG,GAAO,QACtDuG,UAA2B,IAAIzB,IAC/B0B,sBAAuC,IAAI1B,IAC3C2B,QAAS,IACJC,MAAMC,KAAK,CACZ/L,OAAQe,GAAsB6I,GAAaC,EAAeA,EAAe,KAE3Ed,KAAI,KACJ,IACE,MAAMiD,EAAS,IAAIC,OAAOrC,GAa1B,OAZAoC,EAAOE,UAAYjE,MAAOkE,IACxB,MAAM,IAAEjI,EAAG,OAAE4B,GAAWqG,EAAMC,KAC1BtG,EACFmE,EAAShM,IAAIiG,IAAMuB,UAAUK,GAE7BmE,EAAShM,IAAIiG,IAAMwB,SAAS,IAAIQ,MAAM,wCAAwChC,KAChF,EAEF8H,EAAOK,eAAkBF,IACvB,MAAM,IAAEjI,GAAQiI,EAAMC,KACtBnC,EAAShM,IAAIiG,IAAMwB,SAAS,IAAIQ,MAAM,wCAAwChC,KAAO,EAEhF8H,CACT,CAAE,MAAOhG,GAEP,OADAmE,EAAQmB,IAAI9H,KAAK,uBAAwBwC,GAClC,IACT,KACCoD,OAAOrF,SACVuI,aAA8B,IAAIpC,IAClCqC,aAA8B,IAAIrC,IAClCsC,cAAe,GAAG,CAChB/I,EAAYC,IAAkB,aAC9B,gBACA,UACA,OACA0F,OAAOrF,SAAS0I,KAAK,aACvBxC,WACAyC,eAAgB,EAChBC,MAAO,GACP7C,WACA8C,SAAWhP,GACG,0BAARA,EACyB,kBAAbkM,IAAiCA,EAASlM,KAAQ,GAE1C,kBAAbkM,EACFA,EAEFA,EAASlM,KAAQ,GAtG9B,IAA+B8M,EAyG7BP,EAAQmB,IAAI/B,KAAK,yBA5InBtB,eAA6BjG,EAAM6E,GAC7BtE,EAAkBP,KAChBW,EAAeX,IAASY,EAAeZ,SACnC2E,GAAU3E,EAAM6E,SAEhBrB,QAAQqH,IACZ,CAAC,MAAO,SAASC,SAASC,GACjBjB,MAAMC,KAAK/J,EAAKgL,iBAAiBD,IAAYhE,KAAKkE,GAAOtG,GAAUsG,EAAIpG,QAKxF,CAiIQqG,CAAclL,EAAM,CAAE8E,QAASqD,EAAQrD,QAASG,OAAQkD,EAAQmB,IAAI9H,OAC1E2G,EAAQmB,IAAI7B,QAAQ,mBACpB,MAAM,MAAE3F,EAAK,OAAED,GAkBjB,SAA4B7B,EAAMmI,GAChC,IAAI,MAAErG,EAAK,OAAED,GAAWsG,EACxB,GAAIpI,EAAcC,MAAW8B,IAAUD,GAAS,CAC9C,MAAMsJ,EAAMnL,EAAKoL,wBACjBtJ,EAAQA,GAASqJ,EAAIrJ,OAASuJ,OAAOrL,EAAKsL,aAAa,WAAa,EACpEzJ,EAASA,GAAUsJ,EAAItJ,QAAUwJ,OAAOrL,EAAKsL,aAAa,YAAc,CAC1E,CACA,MAAO,CAAExJ,QAAOD,SAClB,CA1B4B0J,CAAmBvL,EAAMmI,GAGnD,OAFAA,EAAQrG,MAAQA,EAChBqG,EAAQtG,OAASA,EACVsG,CACT,CAzGkCqD,CAAcxL,EAAM,IAAK6E,EAASuE,cAAc,GAClF,CAyGA,SAASI,GAAmB9H,GAC1B,IAAKA,EACH,OACF,MAAMlB,EAAQkB,EAAcE,cAAc,SACpC6J,EAAUjL,EAAMkB,cAAcgK,eAAe,qGAOnD,OADAlL,EAAMuC,YAAY0I,GACXjL,CACT,CA6EA,SAASmL,GAAYhK,EAAQwG,GAC3B,GAAIxG,EAAOD,cACT,IACE,MAAMkK,EAAUjK,EAAOK,YACvB,GAAgB,WAAZ4J,EACF,OAAOtH,GAAYsH,EAASjK,EAAOD,cAEvC,CAAE,MAAOsC,GACPmE,EAAQmB,IAAI9H,KAAK,yBAA0BwC,EAC7C,CAEF,MAAM6H,EAASlK,EAAOmK,WAAU,GAC1BC,EAAMpK,EAAOqK,WAAW,MACxBC,EAAYJ,EAAOG,WAAW,MACpC,IAQE,OAPID,GAAOE,GACTA,EAAUC,aACRH,EAAII,aAAa,EAAG,EAAGxK,EAAOG,MAAOH,EAAOE,QAC5C,EACA,GAGGgK,CACT,CAAE,MAAO7H,GACPmE,EAAQmB,IAAI9H,KAAK,yBAA0BwC,EAC7C,CACA,OAAO6H,CACT,CA0GA,MAAMO,GAAgB,CACpB,QACA,SACA,2BAEIC,GAAqB,CACzB,SACA,QAEF,SAASC,GAAgBtM,EAAMuM,EAAepE,GAC5C,MAAM,sBAAEyB,GAA0BzB,EAC5BqE,EAAWxM,EAAKwM,SAASrF,cACzBsF,EAAYvM,EAAiBF,IAAsB,QAAbwM,EACtCE,EAAaD,EAAYJ,GAAmBtF,KAAKlH,GAAS,CAACA,EAAMG,EAAKsL,aAAazL,MAAQuH,QAAO,EAAE,CAAE3K,KAAqB,OAAVA,IAAkB,GACnIb,EAAM,CACV6Q,GAAa,MACbD,EACAE,EAAW3F,KAAI,CAAClH,EAAMpD,IAAU,GAAGoD,KAAQpD,MAASgO,KAAK,KACzD8B,GACAnF,OAAOrF,SAAS0I,KAAK,KACvB,GAAIb,EAAsB+C,IAAI/Q,GAC5B,OAAOgO,EAAsB3N,IAAIL,GACnC,MAAMgR,EA7CR,SAAoBzE,GAClB,IAAIyE,EAAUzE,EAAQyE,QACtB,IAAKA,EAAS,CACZ,MAAM,cAAElL,GAAkByG,EAC1B,IACMzG,IACFkL,EAAUlL,EAAcE,cAAc,UACtCgL,EAAQC,GAAK,eAAevG,OAC5BsG,EAAQ9K,MAAQ,IAChB8K,EAAQ/K,OAAS,IACjB+K,EAAQpM,MAAMsM,WAAa,SAC3BF,EAAQpM,MAAMuM,SAAW,QACzBrL,EAAcsB,KAAKD,YAAY6J,GAC/BA,EAAQI,eAAe7J,SAAS8J,MAAM,8DACtC9E,EAAQyE,QAAUA,EAEtB,CAAE,MAAO5I,GACPmE,EAAQmB,IAAI9H,KAAK,uBAAwBwC,EAC3C,CACF,CACA,OAAO4I,CACT,CAwBkBM,CAAW/E,GACrBgF,EAAgBP,GAASI,cAC/B,IAAKG,EACH,OAAuB,IAAIjF,IAC7B,MAAMkF,EAAkBD,GAAehK,SACvC,IAAIkK,EACApC,EACAwB,GACFY,EAAOD,EAAgB1D,gBAAgBtG,GAAO,OAC9C6H,EAAKoC,EAAK3L,cAAcgI,gBAAgB2D,EAAKC,aAAcd,GAC3DE,EAAWa,SAAQ,EAAE1N,EAAMpD,MACzBwO,EAAGuC,eAAe,KAAM3N,EAAMpD,EAAM,IAEtC4Q,EAAKtK,YAAYkI,IAEjBoC,EAAOpC,EAAKmC,EAAgBxL,cAAc4K,GAE5CvB,EAAGwC,YAAc,IACjBL,EAAgBpK,KAAKD,YAAYsK,GACjC,MAAMK,EAAgBP,EAAcQ,iBAAiB1C,EAAIsB,GACnDqB,EAAyB,IAAI1F,IACnC,IAAK,IAAI2F,EAAMH,EAAc1P,OAAQI,EAAI,EAAGA,EAAIyP,EAAKzP,IAAK,CACxD,MAAMyB,EAAO6N,EAAcI,KAAK1P,GAC5BgO,GAAc9M,SAASO,IAE3B+N,EAAOtP,IAAIuB,EAAM6N,EAAcK,iBAAiBlO,GAClD,CAGA,OAFAuN,EAAgBpK,KAAKgL,YAAYX,GACjCzD,EAAsBtL,IAAI1C,EAAKgS,GACxBA,CACT,CAEA,SAASK,GAAazN,EAAO0N,EAAc/E,GACzC,MAAMgF,EAA4B,IAAIjG,IAChCkG,EAAU,GACVC,EAA6B,IAAInG,IACvC,GAAIiB,EACF,IAAK,MAAMtJ,KAAQsJ,EACjBmF,EAAQzO,QAGV,IAAK,IAAIgO,EAAMrN,EAAMxC,OAAQI,EAAI,EAAGA,EAAIyP,EAAKzP,IAE3CkQ,EADa9N,EAAMsN,KAAK1P,IAI5B,IAAK,IAAIyP,EAAMO,EAAQpQ,OAAQI,EAAI,EAAGA,EAAIyP,EAAKzP,IAC7CiQ,EAAWpS,IAAImS,EAAQhQ,KAAKmP,SAAQ,CAAC9Q,EAAOoD,IAASsO,EAAU7P,IAAIuB,EAAMpD,KAE3E,SAAS6R,EAAQzO,GACf,MAAMpD,EAAQ+D,EAAMuN,iBAAiBlO,GAC/B0O,EAAW/N,EAAMgO,oBAAoB3O,GACrC4O,EAAW5O,EAAK6O,YAAY,KAC5BC,EAASF,GAAY,EAAI5O,EAAK+O,UAAU,EAAGH,QAAY,EAC7D,GAAIE,EAAQ,CACV,IAAI5H,EAAMsH,EAAWpS,IAAI0S,GACpB5H,IACHA,EAAsB,IAAImB,IAC1BmG,EAAW/P,IAAIqQ,EAAQ5H,IAEzBA,EAAIzI,IAAIuB,EAAM,CAACpD,EAAO8R,GACxB,EACIL,EAAajS,IAAI4D,KAAUpD,GAAU8R,KAErCI,EACFP,EAAQS,KAAKF,GAEbR,EAAU7P,IAAIuB,EAAM,CAACpD,EAAO8R,IAEhC,CACA,OAAOJ,CACT,CAmDA,MAAMW,GAAgB,CACpB,UACA,UAGIC,GAAyB,CAC7B,qBACA,4BAEA,2BACA,2BACA,iCAEA,4BACA,oBAmDIC,GAAqC,IAAIC,IAAI,CACjD,WAGFhJ,eAAeiJ,GAAgBlP,EAAM6L,EAAQsD,EAAOhH,EAASiH,GAC3D,GAAIrP,EAAcoP,KAAWnO,EAAemO,IAAUlO,EAAgBkO,IACpE,OACF,GAAIhH,EAAQf,SAAWe,EAAQf,OAAO+H,GACpC,OACEH,GAAmBrC,IAAId,EAAOW,WAAawC,GAAmBrC,IAAIwC,EAAM3C,UAC1ErE,EAAQkH,4BAAyB,EAEjClH,EAAQkH,uBAAyBlH,EAAQmH,iBAE3C,MAAMC,QAAoBzD,GAAUqD,EAAOhH,GAAS,EAAOiH,GACvDjH,EAAQyC,SAAS,0BAoBvB,SAA+B5K,EAAMwP,GACnC,IAAKjP,EAAkBP,KAAUO,EAAkBiP,GACjD,OACF,MAAM,UAAEC,EAAS,WAAEC,GAAe1P,EAClC,IAAKyP,IAAcC,EACjB,OAEF,MAAM,UAAEC,GAAcH,EAAYhP,MAC5BoP,EAAS,IAAIC,UAAUF,IACvB,EAAElU,EAAC,EAAEqU,EAAC,EAAEpS,EAAC,EAAElC,GAAMoU,EACvBA,EAAOnU,EAAI,EACXmU,EAAOE,EAAI,EACXF,EAAOlS,EAAI,EACXkS,EAAOpU,EAAI,EACXoU,EAAOG,eAAeL,GAAaD,GACnCG,EAAOnU,EAAIA,EACXmU,EAAOE,EAAIA,EACXF,EAAOlS,EAAIA,EACXkS,EAAOpU,EAAIA,EACXgU,EAAYhP,MAAMmP,UAAYC,EAAOlJ,UACvC,CAvCIsJ,CAAsBhQ,EAAMuP,GAE9B1D,EAAO9I,YAAYwM,EACrB,CACAtJ,eAAegK,GAAgBjQ,EAAM6L,EAAQ1D,EAASiH,GAEpD,IAAK,IAAID,GADWpP,EAAcC,GAAQA,EAAKkQ,YAAYC,gBAAa,IAAWnQ,EAAKmQ,WAC3DhB,EAAOA,EAAQA,EAAMiB,YAChD,IAAI3P,EAAc0O,GAElB,GAAIpP,EAAcoP,IAAUhO,EAAcgO,IAAyC,mBAAxBA,EAAMkB,cAA8B,CAC7F,MAAMC,EAAQnB,EAAMkB,gBACpB,IAAK,IAAIjS,EAAI,EAAGA,EAAIkS,EAAMtS,OAAQI,UAC1B8Q,GAAgBlP,EAAM6L,EAAQyE,EAAMlS,GAAI+J,EAASiH,EAE3D,YACQF,GAAgBlP,EAAM6L,EAAQsD,EAAOhH,EAASiH,EAG1D,CAoCA,MAAMmB,GAAsB,YAC5BtK,eAAe6F,GAAU9L,EAAMmI,EAASqI,GAAS,EAAOpB,GACtD,MAAM,cAAE1N,EAAa,YAAEqG,EAAW,aAAEuC,GAAiBnC,EACrD,GAAIzG,GAAiBhB,EAAWV,GAI9B,OAHIoP,GAAyB,KAAKqB,KAAKzQ,EAAKoK,OAC1CgF,EAAsBpP,EAAKoK,MAEtB1I,EAAcgK,eAAe1L,EAAKoK,MAE3C,GAAI1I,GAAiBqG,GAAehI,EAAcC,KAAUO,EAAkBP,IAASE,EAAiBF,IAAQ,CAC9G,MAAM0Q,QAxUV,SAAsB1Q,EAAMmI,GAC1B,OAAItH,EAAgBb,GACX2L,GAAY3L,EAAMmI,GAEvB/G,EAAgBpB,GArEtB,SAAqB2Q,EAAQxI,GAC3B,IACE,GAAIwI,GAAQC,iBAAiB5N,KAC3B,OAAO8I,GAAU6E,EAAOC,gBAAgB5N,KAAMmF,EAElD,CAAE,MAAOnE,GACPmE,EAAQmB,IAAI9H,KAAK,yBAA0BwC,EAC7C,CACA,OAAO2M,EAAO7E,WAAU,EAC1B,CA6DW+E,CAAY7Q,EAAMmI,GAEvBxH,EAAeX,GA7DrB,SAAoB8Q,GAClB,MAAMjF,EAASiF,EAAMhF,WAAU,GAQ/B,OAPIgF,EAAMvL,YAAcuL,EAAMvL,aAAeuL,EAAMpM,MACjDmH,EAAOnH,IAAMoM,EAAMvL,WACnBsG,EAAOkF,OAAS,IAEK,SAAnBlF,EAAOpH,UACToH,EAAOpH,QAAU,SAEZoH,CACT,CAoDWmF,CAAWhR,GAEhBY,EAAeZ,GApDrBiG,eAA0BgL,EAAO9I,GAC/B,GAAI8I,EAAMvP,gBAAkBuP,EAAM1L,YAAc0L,EAAMzL,OACpD,OAAOlB,GAAY2M,EAAMzL,OAAQyL,EAAMvP,eAEzC,MAAMmK,EAASoF,EAAMnF,WAAU,GAC/BD,EAAOqF,YAAc,YACjBD,EAAM1L,YAAc0L,EAAM1L,aAAe0L,EAAMvM,MACjDmH,EAAOnH,IAAMuM,EAAM1L,YAErB,MAAM7D,EAAgBmK,EAAOnK,cAC7B,GAAIA,EAAe,CACjB,IAAIyP,GAAU,EAEd,SADMxM,GAAUkH,EAAQ,CAAE9G,QAAS,IAAMoM,GAAU,EAAOlM,OAAQkD,EAAQmB,IAAI9H,QACzE2P,EACH,OAAIF,EAAMzL,OACDlB,GAAY2M,EAAMzL,OAAQyL,EAAMvP,eAElCmK,EAETA,EAAOuF,YAAcH,EAAMG,kBACrB,IAAI5N,SAASC,IACjBoI,EAAOhG,iBAAiB,SAAUpC,EAAS,CAAEqC,MAAM,GAAO,IAE5D,MAAMnE,EAASD,EAAcE,cAAc,UAC3CD,EAAOG,MAAQmP,EAAMI,YACrB1P,EAAOE,OAASoP,EAAMK,aACtB,IACE,MAAMvF,EAAMpK,EAAOqK,WAAW,MAC1BD,GACFA,EAAIwF,UAAU1F,EAAQ,EAAG,EAAGlK,EAAOG,MAAOH,EAAOE,OACrD,CAAE,MAAOmC,GAEP,OADAmE,EAAQmB,IAAI9H,KAAK,wBAAyBwC,GACtCiN,EAAMzL,OACDlB,GAAY2M,EAAMzL,OAAQyL,EAAMvP,eAElCmK,CACT,CACA,OAAOF,GAAYhK,EAAQwG,EAC7B,CACA,OAAO0D,CACT,CAaW2F,CAAWxR,EAAMmI,GAEnBnI,EAAK8L,WAAU,EACxB,CA0T0B2F,CAAazR,EAAMmI,GACzC,GAAIA,EAAQyC,SAAS,4BAA6B,CAChD,MAAM8G,EAAQhB,EAAQiB,oBACtB,IAAK,IAAI9D,EAAM6D,EAAM1T,OAAQI,EAAI,EAAGA,EAAIyP,EAAKzP,IAAK,CAChD,MAAMyB,EAAO6R,EAAMtT,GACdmS,GAAoBE,KAAK5Q,IAC5B6Q,EAAQkB,gBAAgB/R,EAE5B,CACF,CACA,MAAMW,EAAQ2H,EAAQmH,iBA5M1B,SAAuBtP,EAAM6L,EAAQ2E,EAAQrI,GAC3C,MAAM,YAAEJ,EAAW,uBAAEoB,EAAsB,uBAAEkG,GAA2BlH,EAClE0J,EAAchG,EAAOrL,MACrBkN,EAAgB3F,EAAY4F,iBAAiB3N,GAC7CkO,EAAe5B,GAAgBtM,EAAM,KAAMmI,GACjDkH,GAAwB9B,SAAQ,CAACuE,EAAGlW,KAClCsS,EAAa6D,OAAOnW,EAAI,IAE1B,MAAM4E,EAAQyN,GAAaP,EAAeQ,EAAc/E,GA6BxD,OA5BA3I,EAAMuR,OAAO,uBACbvR,EAAMuR,OAAO,OACbvR,EAAMuR,OAAO,KACbvR,EAAMuR,OAAO,WACTvB,IACFhQ,EAAMuR,OAAO,cACbvR,EAAMuR,OAAO,gBACbvR,EAAMuR,OAAO,iBACbvR,EAAMuR,OAAO,eACbvR,EAAMuR,OAAO,sBACbvR,EAAMuR,OAAO,oBACbvR,EAAMuR,OAAO,uBACbvR,EAAMuR,OAAO,qBACbvR,EAAMlC,IAAI,aAAc,CAAC,aAAc,MAEC,SAAtCkC,EAAMvE,IAAI,qBAAqB,IACjC4P,EAAOmG,UAAUC,IAAI,+BAEnB5S,IACGmB,EAAMmM,IAAI,iBACbnM,EAAMlC,IAAI,eAAgB,CAAC,SAAU,KACD,WAAjCkC,EAAMvE,IAAI,gBAAgB,IAAoD,WAAjCuE,EAAMvE,IAAI,gBAAgB,IAAwD,aAApCuE,EAAMvE,IAAI,mBAAmB,IAAqB+D,EAAKkS,cAAgBlS,EAAKmS,aAC1K3R,EAAMlC,IAAI,gBAAiB,CAAC,OAAQ,MAGxCkC,EAAM+M,SAAQ,EAAE9Q,EAAO8R,GAAW1O,KAChCgS,EAAYO,YAAYvS,EAAMpD,EAAO8R,EAAS,IAEzC/N,CACT,CAsK6C6R,CAAcrS,EAAM0Q,EAASF,EAAQrI,GAC1EqI,GAnCR,SAAkC3E,EAAQ1D,GACxC,MAAM,gBAAEE,EAAe,MAAEvG,EAAK,OAAED,EAAQrB,MAAOoN,GAAWzF,EACpD0J,EAAchG,EAAOrL,MAO3B,GANI6H,GACFwJ,EAAYO,YAAY,mBAAoB/J,EAAiB,aAC3DvG,GACF+P,EAAYO,YAAY,QAAS,GAAGtQ,MAAW,aAC7CD,GACFgQ,EAAYO,YAAY,SAAU,GAAGvQ,MAAY,aAC/C+L,EACF,IAAK,MAAM/N,KAAQ+N,EACjBiE,EAAYhS,GAAQ+N,EAAO/N,EAEjC,CAuBMyS,CAAyB5B,EAASvI,GACpC,IAAIoK,GAAgB,EACpB,GAAIpK,EAAQyC,SAAS,iBAAkB,CACrC,MAAM4H,EAAW,CACfhS,EAAMvE,IAAI,gBAAgB,GAC1BuE,EAAMvE,IAAI,gBAAgB,IAE5BsW,EAAgBC,EAASlT,SAAS,YAAckT,EAASlT,SAAS,SAAWkT,EAASlT,SAAS,cAAgBU,EAAKyS,aAAezS,EAAK0S,cAAgB1S,EAAKkS,YAAclS,EAAKmS,YAClL,CACA,MAAMQ,EAAgBnS,EAAMvE,IAAI,oBAAoB,GAC9C2W,EAAWhM,GAAgBpG,EAAMvE,IAAI,iBAAiB,IACtD4W,EAAyBD,EAAYE,IACnB,cAAlBH,EACFG,EAAOA,EAAKC,cACe,cAAlBJ,EACTG,EAAOA,EAAK3L,cACe,eAAlBwL,IACTG,EAAOA,EAAK,GAAGC,cAAgBD,EAAKlE,UAAU,IAEhDgE,EAASrF,SAASyF,IAChB,IAAInM,EAAayD,EAAarO,IAAI+W,GAC7BnM,GACHyD,EAAahM,IAAI0U,EAAQnM,EAA6B,IAAIoI,KAE5D6D,EAAKhM,MAAM,IAAIyG,SAAS0F,GAASpM,EAAWoL,IAAIgB,IAAM,GACtD,OACA,EAiBJ,OAxLJ,SAAyBjT,EAAM6L,EAAQ0G,EAAepK,EAASiH,GAC7D,MAAM,YAAErH,EAAW,gBAAEwB,EAAe,UAAEI,EAAS,iBAAE2F,GAAqBnH,EAGtE,SAAS+K,EAAOC,GACd,MAAMzF,EAAgB3F,EAAY4F,iBAAiB3N,EAAMmT,GACzD,IAAIC,EAAU1F,EAAcK,iBAAiB,WAC7C,IAAKqF,GAAuB,SAAZA,EACd,OACFhE,IAAwBgE,GACxBA,EAAUA,EAAQlM,QAAQ,2BAA4B,IACtD,MAAMmM,EAAU,CAAC/M,MACX4H,EAAe5B,GAAgBtM,EAAMmT,EAAahL,GACxDmH,GAAkB/B,SAAQ,CAACuE,EAAGlW,KAC5BsS,EAAa6D,OAAOnW,EAAI,IAE1B,MAAM4E,EAAQyN,GAAaP,EAAeQ,EAAc/F,EAAQgB,wBAChE3I,EAAMuR,OAAO,WACbvR,EAAMuR,OAAO,kBAC6B,SAAtCvR,EAAMvE,IAAI,qBAAqB,IACjC4P,EAAOmG,UAAUC,IAAI,+BAEvB,MAAMqB,EAAa,CACjB,aAAaF,OAKf,GAHA5S,EAAM+M,SAAQ,EAAE9Q,EAAO8R,GAAW1O,KAChCyT,EAAWzE,KAAK,GAAGhP,MAASpD,IAAQ8R,EAAW,cAAgB,MAAM,IAE7C,IAAtB+E,EAAWtV,OACb,OACF,IACE6N,EAAO1L,UAAY,CAAC0L,EAAO1L,aAAckT,GAAS5I,KAAK,IACzD,CAAE,MAAO8I,GAEP,YADApL,EAAQmB,IAAI9H,KAAK,4BAA6B+R,EAEhD,CACA,MAAM9H,EAAU6H,EAAW7I,KAAK,QAChC,IAAI+I,EAAa7J,EAAU1N,IAAIwP,GAC1B+H,IACHA,EAAa,GACb7J,EAAUrL,IAAImN,EAAS+H,IAEzBA,EAAW3E,KAAK,IAAIwE,EAAQ,MAAMF,IACpC,CAzCK5J,GAAoBxB,IA0CzB+G,GAAcvB,QAAQ2F,GAClBX,GACFxD,GAAuBxB,QAAQ2F,GACnC,CAyHIO,CACEzT,EACA0Q,EACA6B,EACApK,EACA0K,GAtMN,SAAwB7S,EAAM6L,GACxB/K,EAAkBd,KACpB6L,EAAO6H,UAAY1T,EAAKvD,QAEtBqE,EAAkBd,IAASe,EAAef,IAASkB,EAAgBlB,KACrE6L,EAAO8H,aAAa,QAAS3T,EAAKvD,MAEtC,CAiMImX,CAAe5T,EAAM0Q,GAChB9P,EAAeZ,UACZiQ,GACJjQ,EACA0Q,EACAvI,EACA0K,GAGGnC,CACT,CACA,MAAM7E,EAAS7L,EAAK8L,WAAU,GAE9B,aADMmE,GAAgBjQ,EAAM6L,EAAQ1D,GAC7B0D,CACT,CA2CA,SAASgI,GAAa1L,EAAStD,GAC7B,MAAQ3C,IAAK4R,EAAM,YAAEC,EAAc,OAAM,aAAEC,EAAe,OAAM,SAAEC,GAAapP,EAC/E,IAAI3C,EAAM4R,EACV,MAAM,QACJhP,EAAO,cACP0F,EAAa,SACbvC,EAAQ,QACRY,EACAL,OAAO,YACLC,EAAW,eACXC,EAAc,iBACdE,GACD,KACDE,EAAI,QACJe,EAAO,aACPS,GACEnC,EACgB,UAAhB4L,IAA4BxU,GAAaC,IAC3C2I,EAAQuC,iBAEV,IAAIwJ,EAAUjM,EAAShM,IAAI6X,GAC3B,IAAKI,EAAS,CACRxL,GACEA,aAA0ByL,QAAUzL,EAAe+H,KAAKvO,KAC1DA,IAAQ,KAAKuO,KAAKvO,GAAO,IAAM,MAAO,IAAqBkS,MAAQC,WAGvE,MAAMC,EAAgBP,EAAY5R,WAAW,SAAW2G,GAAQA,EAAKyL,OAC/DC,EAA4B,IAAIvF,IAClCqF,GACeP,EAAYjN,MAAM,KAAK,GAAGA,MAAM,KACxCyG,SAASyF,IACX1I,EAAaqC,IAAIqG,IAEtB1I,EAAarO,IAAI+W,GAAQzF,SAAS0F,GAASuB,EAAUvC,IAAIgB,IAAM,IAGnE,MAAMwB,EAAiBH,GAAiBE,EAAUE,KAC5CC,EAAmB,CACvBzS,MACA4C,UACAkP,aAAcS,EAAiB,cAAgBT,EAC/CY,QAAyB,UAAhBb,EAA0B,CAAEc,OAAQrK,QAAkB,KAC5D/B,GAELyL,EAAU,CACR3Q,KAAMwQ,EACNtQ,aAAS,EACTC,YAAQ,EACRoR,SAAU,MAEZZ,EAAQY,SAAW,WACjB,GAAIjM,GAA2B,UAAhBkL,EAAyB,CACtC,MAAMjQ,QAAe+E,EAAQiL,GAC7B,GAAIhQ,EACF,OAAOA,CACX,CACA,OAAKvE,GAAauU,EAAO3R,WAAW,SAAW0H,EAAQ7L,OAC9C,IAAIwF,SAAQ,CAACC,EAASC,KACZmG,EAAQ5B,EAASyM,KAAO7K,EAAQ7L,OAAS,GACjD+W,YAAY,CAAEjB,YAAWa,IAChCT,EAAQzQ,QAAUA,EAClByQ,EAAQxQ,OAASA,CAAM,IAjFjC,SAAmBmB,GACjB,MAAM,IAAE3C,EAAG,QAAE4C,EAAO,aAAEkP,KAAiBvL,GAAgB5D,EACjDmQ,EAAa,IAAIC,gBACjB/P,EAAQJ,EAAUQ,YAAW,IAAM0P,EAAWE,SAASpQ,QAAW,EACxE,OAAO0D,MAAMtG,EAAK,CAAEiT,OAAQH,EAAWG,UAAW1M,IAAehD,MAAMqP,IACrE,IAAKA,EAASM,GACZ,MAAM,IAAIlR,MAAM,iCAAkC,CAAEmR,MAAOP,IAE7D,OAAQd,GACN,IAAK,cACH,OAAOc,EAASQ,cAClB,IAAK,UACH,OAAOR,EAASxR,OAAOmC,KAAKpC,IAE9B,QACE,OAAOyR,EAAS7B,OACpB,IACCsC,SAAQ,IAAMlQ,aAAaH,IAChC,CAkEasQ,CAAUb,EAClB,EAfkB,GAedc,OAAOzR,IAEV,GADAiE,EAAS8J,OAAO+B,GACI,UAAhBC,GAA2BnL,EAE7B,OADAT,EAAQmB,IAAI9H,KAAK,gEAAiEU,GAC/C,iBAArB0G,EAAgCA,EAAmBA,EAAiBqL,GAEpF,MAAMjQ,CAAK,IAEbiE,EAAS3J,IAAIwV,EAAQI,EACvB,CACA,OAAOA,EAAQY,QACjB,CAEA7O,eAAeyP,GAAuBjK,EAASpJ,EAAS8F,EAASwN,GAC/D,IAAKC,GAAUnK,GACb,OAAOA,EACT,IAAK,MAAOqI,EAAQ5R,KAqBtB,SAAsBuJ,EAASpJ,GAC7B,MAAMyB,EAAS,GAKf,OAJA2H,EAAQvE,QAAQ2O,IAAQ,CAACC,EAAKC,EAAW7T,KACvC4B,EAAO+K,KAAK,CAAC3M,EAAKE,EAAWF,EAAKG,KAC3ByT,KAEFhS,EAAOsD,QAAO,EAAElF,MAAUD,EAAUC,IAC7C,CA5B8B8T,CAAavK,EAASpJ,GAChD,IACE,MAAM4T,QAAgBpC,GACpB1L,EACA,CACEjG,MACA6R,YAAa4B,EAAU,QAAU,OACjC3B,aAAc,YAGlBvI,EAAUA,EAAQvE,QAAQgP,GAAKpC,GAAS,KAAKmC,MAC/C,CAAE,MAAOjS,GACPmE,EAAQmB,IAAI9H,KAAK,+BAAgCsS,EAAQ9P,EAC3D,CAEF,OAAOyH,CACT,CACA,SAASmK,GAAUnK,GACjB,MAAO,4BAA4BgF,KAAKhF,EAC1C,CACA,MAAMoK,GAAS,6BASf,SAASK,GAAKhU,GACZ,MAAMiU,EAAUjU,EAAIgF,QAAQ,2BAA4B,QACxD,OAAO,IAAIiN,OAAO,iBAAiBgC,eAAsB,IAC3D,CAEA,MAAMC,GAAa,CACjB,mBACA,sBACA,uBACA,qBACA,oBA+FF,SAASC,GAAUxK,EAAQ1D,GACzB,MAAM,MAAEwC,GAAUxC,EACdpI,EAAc8L,MACZlL,EAAekL,IAAWzL,EAAsByL,KAClDlB,EAAMkE,QA5EZ,SAA2BhD,EAAQ1D,GACjC,GAAIxH,EAAekL,GAAS,CAC1B,MAAMzF,EAAcyF,EAAOtG,YAAcsG,EAAOnH,IAChD,IAAKzC,EAAUmE,GACb,MAAO,CACLyN,GAAa1L,EAAS,CACpBjG,IAAKkE,EACL6N,SAAUpI,EACVkI,YAAa,QACbC,aAAc,YACbvO,MAAMvD,IACFA,IAEL2J,EAAOkF,OAAS,GAChBlF,EAAO1F,QAAQC,YAAcA,EAC7ByF,EAAOnH,IAAMxC,GAAO,GAAE,MAIxB3C,GAAaC,IACf2I,EAAQuC,gBAEZ,MAAO,GAAIxK,EAAiB2L,KAAY5J,EAAU4J,EAAO5I,KAAK8C,SAAU,CACtE,MAAMK,EAAcyF,EAAO5I,KAAK8C,QAChC,MAAO,CACL8N,GAAa1L,EAAS,CACpBjG,IAAKkE,EACL6N,SAAUpI,EACVkI,YAAa,QACbC,aAAc,YACbvO,MAAMvD,IACFA,IAEL2J,EAAO1F,QAAQC,YAAcA,EAC7ByF,EAAO5I,KAAK8C,QAAU7D,GAAO,GAAE,IAGrC,CACA,MAAO,EACT,CAqCoBoU,CAAkBzK,EAAQ1D,IAEtC7H,EAAoBuL,IACtBlB,EAAMkE,QAtCZ,SAAqBhD,EAAQ1D,GAC3B,MAAM,cAAEzG,EAAa,eAAE+H,GAAmBtB,EACpClF,EAAO4I,EAAOP,aAAa,SAAWO,EAAOP,aAAa,cAChE,IAAKrI,EACH,MAAO,GACT,MAAOsT,EAAQ1J,GAAM5J,EAAK6D,MAAM,KAChC,GAAI+F,EAAI,CACN,MAAM2J,EAAQ,IAAI3J,IACZlR,EAAa+F,GAAe+U,cAAc,OAAOD,KAIvD,GAHID,GACF1K,EAAO8H,aAAa,OAAQ6C,GAE1B/M,GAAgBgN,cAAcD,GAChC,MAAO,GACT,GAAI7a,EAEF,OADA8N,GAAgB1G,YAAYpH,EAAWmQ,WAAU,IAC1C,GACF,GAAIyK,EACT,MAAO,CACL1C,GAAa1L,EAAS,CACpBjG,IAAKqU,EACLvC,aAAc,SACbvO,MAAMiR,IACPjN,GAAgBkN,mBAAmB,YAAaD,EAAQ,IAIhE,CACA,MAAO,EACT,CASoBE,CAAY/K,EAAQ1D,KAGlC5H,EAAkBsL,IACpBlB,EAAMkE,QAxGV,SAA4BrO,EAAO2H,GACjC,OAAOiO,GAAWrP,KAAK8P,IACrB,MAAMpa,EAAQ+D,EAAMuN,iBAAiB8I,GACrC,OAAKpa,GAAmB,SAAVA,IAGV8C,GAAaC,IACf2I,EAAQuC,iBAEHgL,GAAuBjZ,EAAO,KAAM0L,GAAS,GAAM1C,MAAMqR,IACzDA,GAAYra,IAAUqa,GAE3BtW,EAAM4R,YACJyE,EACAC,EACAtW,EAAMgO,oBAAoBqI,GAC3B,KAZM,IAaP,IACDzP,OAAOrF,QACZ,CAqFkBgV,CAAmBlL,EAAOrL,MAAO2H,IAEjD0D,EAAOmL,WAAWzJ,SAAS4B,IACzBkH,GAAUlH,EAAOhH,EAAQ,GAE7B,CAqFA,MAAM8O,GAAc,sBACdC,GAAe,gDAmCfC,GAAqB,8CACrBC,GAAc,qDACpB,SAASC,GAAsBC,EAAKnP,GAClC,MAAM,KAAEW,GAASX,EACXoP,EAAkBzO,EAAOA,GAAMyO,qBAAkB,EACvD,OAAOA,EAAkBD,EAAIpQ,QAAQkQ,IAAc9U,IACjD,OAAa,CACX,MAAOoC,EAAK,CAAE8S,GAAUL,GAAmBM,KAAKnV,IAAU,GAC1D,IAAKkV,EACH,MAAO,GACT,GAAIA,IAAWD,EACb,MAAO,QAAQ7S,IACnB,KACG4S,CACP,CAEArR,eAAeyR,GAAsB1X,EAAM6E,GACzC,MAAMsD,QAAgBT,GAAgB1H,EAAM6E,GAC5C,GAAI9E,EAAcoI,EAAQnI,OAASE,EAAiBiI,EAAQnI,MAC1D,OAAOmI,EAAQnI,KACjB,MAAM,cACJ0B,EAAa,IACb4H,EAAG,MACHqB,EAAK,gBACLpB,EAAe,eACfE,EAAc,UACdE,EAAS,KACTb,EAAI,SACJP,EAAQ,aACRa,EAAY,YACZJ,EAAW,YACXC,EAAW,yBACXC,GACEf,EACJmB,EAAI/B,KAAK,cACT,MAAMoQ,QAAc7L,GAAU3D,EAAQnI,KAAMmI,GAAS,GACrD,GAAIoB,GAAmB7H,EAAe,CACpC,IAAIkW,EAAa,GACjBjO,EAAU4D,SAAQ,CAAC8F,EAAS5H,KAC1BmM,GAAc,GAAGvE,EAAQ5I,KAAK,eAChCgB,QAEH,IAEGlC,EAAgBxG,YAAYrB,EAAcgK,eAAekM,GAC3D,CACAtO,EAAI7B,QAAQ,oBACNuB,IAAc2O,KACP,IAAT7O,GAAkB/I,EAAc4X,KAClCrO,EAAI/B,KAAK,wBAxKbtB,eAA4B0R,EAAOxP,GACjC,MAAM,cACJzG,EAAa,gBACb6H,EAAe,aACfe,EAAY,aACZC,EAAY,MACZI,EAAK,KACL7B,GACEX,EACJ,GAAKzG,GAAkB6H,GAAoBe,EAAaoK,KAGxD,GAAI5L,GAAQA,EAAK2C,QAAS,CACxB,MAAMA,EAAU4L,GAAsBvO,EAAK2C,QAAStD,GACpDoB,EAAgBxG,YAAYrB,EAAcgK,eAAe,GAAGD,OAE9D,KAAO,CACL,MAAMoM,EAAc/N,MAAMC,KAAKrI,EAAcmW,aAAazQ,QAAQ0Q,IAChE,IACE,MAAO,aAAcA,GAAc/V,QAAQ+V,EAAWC,SAAS/Z,OACjE,CAAE,MAAOgG,GAEP,OADAmE,EAAQmB,IAAI9H,KAAK,sCAAsCsW,EAAW7U,OAAQe,IACnE,CACT,WAEIR,QAAQqH,IACZgN,EAAY/M,SAASgN,GACZhO,MAAMC,KAAK+N,EAAWC,UAAUhR,KAAId,MAAO+R,EAASC,KACzD,GAAInY,EAAgBkY,GAAU,CAC5B,IAAIE,EAAcD,EAAQ,EAC1B,MAAM5V,EAAU2V,EAAQ/U,KACxB,IAAIwI,EAAU,GACd,IACEA,QAAgBoI,GAAa1L,EAAS,CACpCjG,IAAKG,EACL0R,YAAa,OACbC,aAAc,QAElB,CAAE,MAAOhQ,GACPmE,EAAQmB,IAAI9H,KAAK,sCAAsCa,IAAW2B,EACpE,CACA,MAAMmU,EAAkB1M,EAAQvE,QAC9B2O,IACA,CAACC,EAAKC,EAAW7T,IAAQ4T,EAAI5O,QAAQhF,EAAKE,EAAWF,EAAKG,MAE5D,IAAK,MAAM1C,KAwCvB,SAAkByY,GAChB,GAAc,MAAVA,EACF,MAAO,GACT,MAAMtU,EAAS,GACf,IAAI2H,EAAU2M,EAAOlR,QAAQ+P,GAAa,IAC1C,OAAa,CACX,MAAMoB,EAAUnB,GAAaO,KAAKhM,GAClC,IAAK4M,EACH,MACFvU,EAAO+K,KAAKwJ,EAAQ,GACtB,CACA5M,EAAUA,EAAQvE,QAAQgQ,GAAc,IACxC,MAAMoB,EAAY,yCACZC,EAAa,IAAIpE,OAErB,6GACA,MAEF,OAAa,CACX,IAAIkE,EAAUC,EAAUb,KAAKhM,GAC7B,GAAK4M,EAQHE,EAAWC,UAAYF,EAAUE,cARrB,CAEZ,GADAH,EAAUE,EAAWd,KAAKhM,IACrB4M,EACH,MAEAC,EAAUE,UAAYD,EAAWC,SAErC,CAGA1U,EAAO+K,KAAKwJ,EAAQ,GACtB,CACA,OAAOvU,CACT,CAzE+B2U,CAASN,GAC1B,IACEL,EAAWY,WACT/Y,EACAA,EAAKwC,WAAW,WAAa+V,GAAe,EAAIJ,EAAWC,SAAS/Z,OAExE,CAAE,MAAOgG,GACPmE,EAAQmB,IAAI9H,KAAK,8CAA+C,CAAE7B,OAAMqE,SAC1E,CAEJ,QAIW6T,EAAY/M,SAASgN,GAAehO,MAAMC,KAAK+N,EAAWC,YAClE3Q,QAAQ4Q,GAAYtY,EAAkBsY,IAAYpC,GAAUoC,EAAQxX,MAAMuN,iBAAiB,SAAWnH,GAAgBoR,EAAQxX,MAAMuN,iBAAiB,iBAAiB4K,MAAM3R,GAAQsD,EAAaqC,IAAI3F,OAAOuG,SAAS9Q,IAC5N,MAAMkD,EAAOlD,EACPgP,EAAUlB,EAAatO,IAAI0D,EAAK8L,SAClCA,EACFlC,EAAgBxG,YAAYrB,EAAcgK,eAAe,GAAGD,QAG5Dd,EAAMkE,KACJ6G,GACE/V,EAAK8L,QACL9L,EAAKiZ,iBAAmBjZ,EAAKiZ,iBAAiB3V,KAAO,KACrDkF,GACA1C,MAAMoT,IACNA,EAAWxB,GAAsBwB,EAAU1Q,GAC3CoC,EAAajM,IAAIqB,EAAK8L,QAASoN,GAC/BtP,EAAgBxG,YAAYrB,EAAcgK,eAAe,GAAGmN,OACrE,IAGG,GAEJ,CACF,CAuFUC,CAAanB,EAAOxP,GAC1BmB,EAAI7B,QAAQ,mBAEd6B,EAAI/B,KAAK,cACT8O,GAAUsB,EAAOxP,GACjB,MAAM4Q,EAAQpO,EAAM3M,OACpB,IAAIgb,EAAU,EAcdzQ,IAAWyQ,EAASD,SACdvV,QAAQqH,IAAI,IAAIf,MAAMC,KAAK,CAAE/L,OAAQ,KAAM+I,KAdjCd,UACd,OAAa,CACX,MAAMgT,EAAOtO,EAAMuO,MACnB,IAAKD,EACH,MACF,UACQA,CACR,CAAE,MAAOjV,GACPmE,EAAQmB,IAAI9H,KAAK,qBAAsBwC,EACzC,CACAuE,MAAayQ,EAASD,EACxB,MAIFzP,EAAI7B,QAAQ,oBACNwB,IAAc0O,IACpB,MAAMwB,EAOR,SAAgCxB,EAAOxP,GACrC,MAAM,MAAErG,EAAK,OAAED,GAAWsG,EACpBgR,EA/zCR,SAAmBrX,EAAOD,EAAQH,GAChC,MAAMyX,EAAMzW,GAAYhB,GAAegI,gBAAgBtG,GAAO,OAI9D,OAHA+V,EAAI3L,eAAe,KAAM,QAAS1L,EAAM4E,YACxCyS,EAAI3L,eAAe,KAAM,SAAU3L,EAAO6E,YAC1CyS,EAAI3L,eAAe,KAAM,UAAW,OAAO1L,KAASD,KAC7CsX,CACT,CAyzCcC,CAAUtX,EAAOD,EAAQ8V,EAAMjW,eACrC2X,EAAgBF,EAAIzX,cAAcgI,gBAAgByP,EAAI7L,aAAc,iBAO1E,OANA+L,EAAc7L,eAAe,KAAM,IAAK,MACxC6L,EAAc7L,eAAe,KAAM,IAAK,MACxC6L,EAAc7L,eAAe,KAAM,QAAS,QAC5C6L,EAAc7L,eAAe,KAAM,SAAU,QAC7C6L,EAAcC,OAAO3B,GACrBwB,EAAIpW,YAAYsW,GACTF,CACT,CAlBcI,CAAuB5B,EAAOxP,GAK1C,OAJAsB,GAAkB0P,EAAIK,aAAa/P,EAAgB0P,EAAIM,SAAS,IAChElQ,GAAmB4P,EAAIK,aAAajQ,EAAiB4P,EAAIM,SAAS,IAClErQ,GAvdF,SAAwBjB,GAOtB,GANAA,EAAQzG,mBAAgB,EACxByG,EAAQJ,iBAAc,EACtBI,EAAQoB,qBAAkB,EAC1BpB,EAAQsB,oBAAiB,EACzBtB,EAAQwB,UAAU+P,QAClBvR,EAAQyB,sBAAsB8P,QAC1BvR,EAAQyE,QAAS,CACnB,IACEzE,EAAQyE,QAAQ+M,QAClB,CAAE,MAAOpG,GACPpL,EAAQmB,IAAI9H,KAAK,2BAA4B+R,EAC/C,CACApL,EAAQyE,aAAU,CACpB,CACAzE,EAAQ0B,QAAU,GAClB1B,EAAQmC,aAAaoP,QACrBvR,EAAQoC,aAAamP,QACrBvR,EAAQF,SAASyR,QACjBvR,EAAQwC,MAAQ,EAClB,CAmckBiP,CAAezR,SACzBe,IAA2BiQ,IAC1BA,CACT,CAcAlT,eAAe4T,GAAY7Z,EAAM6E,GAC/B,MAAMsD,QAAgBT,GAAgB1H,EAAM6E,GACtCsU,QAAYzB,GAAsBvP,GAClC8N,EAt0CR,SAAsBkD,EAAKW,GACzB,IAAIC,GAAQ,IAAIC,eAAgBC,kBAAkBd,GAIlD,OAHIW,IACFC,EAAQA,EAAM7S,QAAQ,8DAA+D,KAEhF,oCAAoCgT,mBAAmBH,IAChE,CAg0CkBI,CAAahB,EAAKhR,EAAQyC,SAAS,2BAC9CzC,EAAQiB,eACXjB,EAAQoB,gBAAkBC,GAAmBrB,EAAQzG,eACrDyG,EAAQsB,eAAiBtB,EAAQzG,eAAegI,gBAAgBtG,GAAO,QACvE+E,EAAQwB,UAAU+P,SAEpB,MAAM5I,EAAQxM,GAAY2R,EAASkD,EAAIzX,eACvC,aAxhCFuE,eAA6B6K,EAAO3I,GAClC,MAAM,IACJmB,EAAG,QACHxE,EAAO,eACP4F,EAAc,kBACd3B,GACEZ,EACJmB,EAAI/B,KAAK,mBACT,MAAM6S,QAAezV,GAAUmM,EAAO,CAAEhM,UAASG,OAAQkD,EAAQmB,IAAI9H,QAC/D,OAAEG,EAAM,UAAE0Y,GAuBlB,SAAsB3Y,EAAeyG,GACnC,MAAM,MAAErG,EAAK,OAAED,EAAM,MAAE8F,EAAK,gBAAEU,EAAiBC,kBAAmBgS,GAAQnS,EACpExG,EAASD,EAAcE,cAAc,UAC3CD,EAAOG,MAAQ0E,KAAK+T,MAAMzY,EAAQ6F,GAClChG,EAAOE,OAAS2E,KAAK+T,MAAM1Y,EAAS8F,GACpChG,EAAOnB,MAAMsB,MAAQ,GAAGA,MACxBH,EAAOnB,MAAMqB,OAAS,GAAGA,MACrByY,IACE3Y,EAAOG,MAAQwY,GAAO3Y,EAAOE,OAASyY,KACpC3Y,EAAOG,MAAQwY,GAAO3Y,EAAOE,OAASyY,EACpC3Y,EAAOG,MAAQH,EAAOE,QACxBF,EAAOE,QAAUyY,EAAM3Y,EAAOG,MAC9BH,EAAOG,MAAQwY,IAEf3Y,EAAOG,OAASwY,EAAM3Y,EAAOE,OAC7BF,EAAOE,OAASyY,GAET3Y,EAAOG,MAAQwY,GACxB3Y,EAAOE,QAAUyY,EAAM3Y,EAAOG,MAC9BH,EAAOG,MAAQwY,IAEf3Y,EAAOG,OAASwY,EAAM3Y,EAAOE,OAC7BF,EAAOE,OAASyY,IAItB,MAAMD,EAAY1Y,EAAOqK,WAAW,MAKpC,OAJIqO,GAAahS,IACfgS,EAAUG,UAAYnS,EACtBgS,EAAUI,SAAS,EAAG,EAAG9Y,EAAOG,MAAOH,EAAOE,SAEzC,CAAEF,SAAQ0Y,YACnB,CAvDgCK,CAAa5J,EAAMpP,cAAeyG,GAC1DoJ,EAAY,KAChB,IACE8I,GAAW9I,UAAU6I,EAAQ,EAAG,EAAGzY,EAAOG,MAAOH,EAAOE,OAC1D,CAAE,MAAOmC,GACPmE,EAAQmB,IAAI9H,KAAK,sBAAuBwC,EAC1C,GAGF,GADAuN,IACIpJ,EAAQyC,SAAS,mBACnB,IAAK,IAAIxM,EAAI,EAAGA,EAAIsM,EAAgBtM,UAC5B,IAAIoF,SAASC,IACjB6B,YAAW,KACTiM,IACA9N,GAAS,GACRrF,EAAI2K,EAAkB,IAM/B,OAFAZ,EAAQuC,eAAiB,EACzBpB,EAAI7B,QAAQ,mBACL9F,CACT,CAy/BegZ,CAAc7J,EAAO3I,EACpC,CAoFAlC,eAAe2U,GAAU5a,EAAM6E,GAC7B,OA9DFoB,eAA4BjG,EAAM6E,GAChC,MAAMsD,QAAgBT,GAAgB1H,EAAM6E,IACtC,IAAEyE,EAAG,QAAElB,EAAO,KAAE7E,EAAI,IAAElG,GAAQ8K,EAC9BxG,QAAekY,GAAY1R,GACjCmB,EAAI/B,KAAK,sBACT,IAAI0O,EAAUtU,EAAOK,UAAUuB,EAAM6E,GACrC,GAAI,CAAC,YAAa,cAAc9I,SAASiE,IAASlG,GAAO2B,GAAgBC,EAAc,CACrF,MAAOuY,EAAQxU,GAAQiT,EAAQnP,MAAM,KACrC,IAAI+T,EAAe,EACfvd,GAAgB,EACpB,GAAa,cAATiG,EAAsB,CACxB,MAAMuX,EA/7CZ,SAAoC7E,GAClC,IAAI8E,EAAW9E,EAAQ+E,QAAQvc,GAO/B,OANkB,IAAdsc,IACFA,EAAW9E,EAAQ+E,QAAQtc,KAEX,IAAdqc,IACFA,EAAW9E,EAAQ+E,QAAQrc,IAEtBoc,CACT,CAs7CuBE,CAA2BjY,GACxC8X,GAAY,GACdD,EAAgD,EAAjCrU,KAAK0U,MAAMJ,EAAW,IAAM,GAC3Cxd,GAAgB,GAEhBud,EAAe,EAEnB,KAAoB,eAATtX,IACTsX,EAAe,IAEjB,MAAMM,EAAenY,EAAK4L,UAAU,EAAGiM,GACjCO,EAAapY,EAAK4L,UAAUiM,GAC5BQ,EAAcvc,OAAOwc,KAAKH,GAC1B/d,EAAa,IAAII,WAAW6d,EAAYrd,QAC9C,IAAK,IAAII,EAAI,EAAGA,EAAIhB,EAAWY,OAAQI,IACrChB,EAAWgB,GAAKid,EAAYve,WAAWsB,GAEzC,MAAMmd,EAAsB,cAAThY,EAAuBpG,EAAaC,EAAYC,EAAKC,GAviD5E,SAAuBF,EAAYC,GAMjC,OALAD,EAAW,IAAM,EACjBA,EAAW,IAAMC,GAAO,EACxBD,EAAW,IAAY,IAANC,EACjBD,EAAW,IAAMC,GAAO,EACxBD,EAAW,IAAY,IAANC,EACVD,CACT,CAgiD6Foe,CAAcpe,EAAYC,GAEnH4Y,EAAU,CAACuB,EAAQ,IADE1Y,OAAO2c,KAAKC,OAAOC,gBAAgBJ,IAClBH,GAAY3Q,KAAK,GACzD,CAEA,OADAnB,EAAI7B,QAAQ,sBACLwO,CACT,CA4BS2F,OACClU,GAAgB1H,EAAM,IAAK6E,EAAStB,KAAM,eAEpD,CCrkDAsY,IAAAA,aAAiB5J,IAAI,yBAAyB,WAC5C,SAAS6J,EAAQ5Z,GAEH,IAAI6Z,EAAQ7Z,EAAI4E,MAAM,OAGtB,GAAqB,IAAjBiV,EAAM/d,OAAc,CAEtB,IAAIge,EAAWD,EAAM,GAAGjV,MAAM,KAG9B,GAAIkV,EAAShe,OAAS,EAEpB,OAAO+d,EAAM,GAAK,MAAQC,EAAS,EAEvC,CAGA,OAAO9Z,CACb,CAENpD,OAAOmd,SAAQ,GAGjBC,EAAAA,EAAAA,QAAOC,IAAc,gBAAgB,SAAUC,EAAOC,GAAM,IAAAC,EAAA,KACpDC,EAAUV,IAAAA,MAAUW,UAAU,WAAaX,IAAAA,MAAUQ,KAAKA,GAEhED,EAAMnK,IACJ,cACAwK,IAAAA,UACE,CACEC,SAAWT,QACXU,KAAM,gBACNC,MAAOX,QAAS,GAAG,WAEnBY,QAAS,WAAM,IAAAC,EAAAC,EACX,GAAId,QAAJ,CAIFnd,OAAOke,kBAAkB,MACzBle,OAAOmd,SAAQ,EACf1a,QAAQ+H,IAAI,oBACZ/H,QAAQ+H,IAAIgT,GACZ,IAAItc,EAAKmD,SAASsT,cAAe,6BAA8B4F,EAAKjS,KAAKyC,GAAG,OAExE1B,EAAMhI,SAASvB,cAAc,OACjCuJ,EAAIhL,UAAU,sBAEd,IAAI8c,EAAW9Z,SAASvB,cAAc,OACtCqb,EAAS9c,UAAU,4BAEnB,IAAI+c,EAAMld,EAAK8L,WAAU,GACzBoR,EAAM/c,WAAW,mBAGFgD,SAASvB,cAAc,OAC7BzB,UAAY,sBAKrB,IAAIgd,EAAUha,SAASvB,cAAc,OACrCub,EAAQhd,UAAY,uBACpBgd,EAAQzJ,UAAW,4BAA4BoI,EAAQS,GAAU,IAAIV,IAAAA,MAAUzR,KAAKsC,WAAW0Q,MAAM,WAAe,MAAHvB,KAAY,OAATiB,EAAHjB,IAAAA,UAAkB,OAANiB,EAAZA,EAAcO,OAAU,OAANP,EAAlBA,EAAoB1S,OAApB0S,EAA0BQ,UAAa,MAAHzB,KAAY,OAATkB,EAAHlB,IAAAA,UAAkB,OAANkB,EAAZA,EAAcM,OAAU,OAANN,EAAlBA,EAAoB3S,WAAI,EAAxB2S,EAA0BO,UAAU,IAIzLnS,EAAIpI,YAAaoa,GACjBhS,EAAIpI,YAAama,GACjBD,EAASla,YAAYoI,GACrBnL,EAAK+C,YAAYka,GACjB9R,EAAIH,iBAAiB,uBAAuBuC,SAAQ,SAAChJ,GACnDA,EAAIqN,gBAAgB,WACpBrN,EAAIqN,gBAAgB,aACtB,IAGA,IADA,IAAI2L,EAAOpS,EAAIH,iBAAiB,yDACxB5M,EAAG,EAAGA,EAAGmf,EAAKvf,SAAUI,EAC7Bmf,EAAKnf,GAAGof,WAAWxP,YAAYuP,EAAKnf,IAIvCkH,YAAW,WACRsV,GAAUzP,EAAI,CACX/C,QAAQ,GACRT,MAAM,EACNL,OAAO,EACPO,aAAc,GACd/C,QAAQ,IACRyD,SAAU,SAACyQ,EAASyE,GAClB3e,OAAOmd,SAAQ,EACfyB,EAAEC,SACFpc,QAAQ+H,IAAQ0P,EAAO,IAAMyE,GAC7B3e,OAAOke,kBAAsBhE,EAAO,IAAMyE,CAC5C,EACA3V,SAAW,CACP8V,iBAAgB,KAEnBnY,MAAK,SAAAwQ,GACV,IAAM4H,EAAO1a,SAASvB,cAAc,KACpCic,EAAKC,SAAW,aAAajC,IAAAA,MAAUzR,KAAKsC,WAAW0Q,MAAOvB,IAAAA,MAAUQ,KAAKA,GAAM,QACnFwB,EAAK5a,KAAOgT,EACZ4H,EAAKE,QACLjf,OAAOmd,SAAQ,EACfyB,EAAEC,SACF3d,EAAKgO,YAAYiP,EACnB,GAEA,GAAE,IAvES,MADPS,EAAEC,QA2ER,GAEF7e,OAAOmd,QAAWJ,IAAAA,WAAemC,MAAM,wCAAyClf,OAAOke,mBAI7F,KAIAd,EAAAA,EAAAA,QAAO+B,IAAoB,gBAAgB,SAAU7B,EAAO8B,GAAY,IAAAC,EAAA,KAChEC,EAAgBvC,IAAAA,MAAUW,UAAU,WAAaX,IAAAA,MAAUqC,WAAWA,GAG5E9B,EAAMnK,IACJ,cACAwK,IAAAA,UACE,CACEC,SAAWT,QACXU,KAAM,gBACNC,MAAOX,QAAS,GAAG,WAEnBY,QAAS,WAAM,IAAAwB,EAAAC,EACb,GAAIrC,QAAJ,CAGAnd,OAAOke,kBAAkB,MACzBle,OAAOmd,SAAQ,EACf1a,QAAQ+H,IAAI,oBACZ/H,QAAQ+H,IAAI6U,GACZ,IAAIne,EAAKmD,SAASsT,cAAe,8BAE7BtL,EAAMhI,SAASvB,cAAc,OACjCuJ,EAAIhL,UAAU,sBAEd,IAAI8c,EAAW9Z,SAASvB,cAAc,OACtCqb,EAAS9c,UAAU,4BAEnB,IAAI+c,EAAMld,EAAK8L,WAAU,GACzBoR,EAAM/c,WAAW,mBAGjB,IAAIoe,EAAWpb,SAASvB,cAAc,OACtC2c,EAASpe,UAAY,WAKrB,IAAIgd,EAAUha,SAASvB,cAAc,OACrCub,EAAQhd,UAAY,uBACpBgd,EAAQzJ,UAAW,4BAA4BoI,EAAQsC,GAAgB,IAAIvC,IAAAA,MAAUzR,KAAKsC,WAAW0Q,MAAM,WAAe,MAAHvB,KAAY,OAATwC,EAAHxC,IAAAA,UAAkB,OAANwC,EAAZA,EAAchB,OAAU,OAANgB,EAAlBA,EAAoBjU,OAApBiU,EAA0Bf,UAAa,MAAHzB,KAAY,OAATyC,EAAHzC,IAAAA,UAAkB,OAANyC,EAAZA,EAAcjB,OAAU,OAANiB,EAAlBA,EAAoBlU,WAAI,EAAxBkU,EAA0BhB,UAAU,IAChMnS,EAAIpI,YAAYwb,GAEfpT,EAAIpI,YAAaoa,GACjBhS,EAAIpI,YAAama,GACjBD,EAASla,YAAYoI,GACrBnL,EAAK+C,YAAYka,GACjB9R,EAAIH,iBAAiB,uBAAuBuC,SAAQ,SAAChJ,GACnDA,EAAIqN,gBAAgB,WACpBrN,EAAIqN,gBAAgB,aACtB,IAEA,IADA,IAAI2L,EAAOpS,EAAIH,iBAAiB,yDACxB5M,EAAG,EAAGA,EAAGmf,EAAKvf,SAAUI,EAC7Bmf,EAAKnf,GAAGof,WAAWxP,YAAYuP,EAAKnf,IAGvCkH,YAAW,WACRsV,GAAUzP,EAAI,CACX/C,QAAQ,GACRT,MAAM,EACNL,OAAO,EACPO,aAAc,GACd/C,QAAQ,IACRyD,SAAU,SAACyQ,EAASyE,GAClB3e,OAAOmd,SAAQ,EACfyB,EAAEC,SACFpc,QAAQ+H,IAAQ0P,EAAO,IAAMyE,GAC7B3e,OAAOke,kBAAsBhE,EAAO,IAAMyE,CAC5C,EACA3V,SAAW,CACP8V,iBAAgB,KAEnBnY,MAAK,SAAAwQ,GACV,IAAM4H,EAAO1a,SAASvB,cAAc,KACpCic,EAAKC,SAAW,aAAajC,IAAAA,MAAUzR,KAAKsC,WAAW0Q,MAAM,QAC7DS,EAAK5a,KAAOgT,EACZ4H,EAAKE,QACLjf,OAAOmd,SAAQ,EACfyB,EAAEC,SACJ3d,EAAKgO,YAAYiP,EACjB,GACA,GAAG,IAlEM,MADPS,EAAEC,QAsEN,GAEF7e,OAAOmd,QAAWJ,IAAAA,WAAemC,MAAM,wCAAyClf,OAAOke,mBAI7F,GAGF,G","sources":["webpack://tohsakarat-post-camera/webpack/bootstrap","webpack://tohsakarat-post-camera/webpack/runtime/compat get default export","webpack://tohsakarat-post-camera/webpack/runtime/define property getters","webpack://tohsakarat-post-camera/webpack/runtime/hasOwnProperty shorthand","webpack://tohsakarat-post-camera/webpack/runtime/make namespace object","webpack://tohsakarat-post-camera/external root \"flarum.core.compat['forum/app']\"","webpack://tohsakarat-post-camera/external root \"flarum.core.compat['common/extend']\"","webpack://tohsakarat-post-camera/external root \"flarum.core.compat['forum/utils/DiscussionControls']\"","webpack://tohsakarat-post-camera/external root \"flarum.core.compat['forum/utils/PostControls']\"","webpack://tohsakarat-post-camera/external root \"flarum.core.compat['common/components/Button']\"","webpack://tohsakarat-post-camera/./node_modules/modern-screenshot/dist/index.mjs","webpack://tohsakarat-post-camera/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/utils/DiscussionControls'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/utils/PostControls'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","function changeJpegDpi(uint8Array, dpi) {\n  uint8Array[13] = 1;\n  uint8Array[14] = dpi >> 8;\n  uint8Array[15] = dpi & 255;\n  uint8Array[16] = dpi >> 8;\n  uint8Array[17] = dpi & 255;\n  return uint8Array;\n}\n\nconst _P = \"p\".charCodeAt(0);\nconst _H = \"H\".charCodeAt(0);\nconst _Y = \"Y\".charCodeAt(0);\nconst _S = \"s\".charCodeAt(0);\nlet pngDataTable;\nfunction createPngDataTable() {\n  const crcTable = new Int32Array(256);\n  for (let n = 0; n < 256; n++) {\n    let c = n;\n    for (let k = 0; k < 8; k++) {\n      c = c & 1 ? 3988292384 ^ c >>> 1 : c >>> 1;\n    }\n    crcTable[n] = c;\n  }\n  return crcTable;\n}\nfunction calcCrc(uint8Array) {\n  let c = -1;\n  if (!pngDataTable)\n    pngDataTable = createPngDataTable();\n  for (let n = 0; n < uint8Array.length; n++) {\n    c = pngDataTable[(c ^ uint8Array[n]) & 255] ^ c >>> 8;\n  }\n  return c ^ -1;\n}\nfunction searchStartOfPhys(uint8Array) {\n  const length = uint8Array.length - 1;\n  for (let i = length; i >= 4; i--) {\n    if (uint8Array[i - 4] === 9 && uint8Array[i - 3] === _P && uint8Array[i - 2] === _H && uint8Array[i - 1] === _Y && uint8Array[i] === _S) {\n      return i - 3;\n    }\n  }\n  return 0;\n}\nfunction changePngDpi(uint8Array, dpi, overwritepHYs = false) {\n  const physChunk = new Uint8Array(13);\n  dpi *= 39.3701;\n  physChunk[0] = _P;\n  physChunk[1] = _H;\n  physChunk[2] = _Y;\n  physChunk[3] = _S;\n  physChunk[4] = dpi >>> 24;\n  physChunk[5] = dpi >>> 16;\n  physChunk[6] = dpi >>> 8;\n  physChunk[7] = dpi & 255;\n  physChunk[8] = physChunk[4];\n  physChunk[9] = physChunk[5];\n  physChunk[10] = physChunk[6];\n  physChunk[11] = physChunk[7];\n  physChunk[12] = 1;\n  const crc = calcCrc(physChunk);\n  const crcChunk = new Uint8Array(4);\n  crcChunk[0] = crc >>> 24;\n  crcChunk[1] = crc >>> 16;\n  crcChunk[2] = crc >>> 8;\n  crcChunk[3] = crc & 255;\n  if (overwritepHYs) {\n    const startingIndex = searchStartOfPhys(uint8Array);\n    uint8Array.set(physChunk, startingIndex);\n    uint8Array.set(crcChunk, startingIndex + 13);\n    return uint8Array;\n  } else {\n    const chunkLength = new Uint8Array(4);\n    chunkLength[0] = 0;\n    chunkLength[1] = 0;\n    chunkLength[2] = 0;\n    chunkLength[3] = 9;\n    const finalHeader = new Uint8Array(54);\n    finalHeader.set(uint8Array, 0);\n    finalHeader.set(chunkLength, 33);\n    finalHeader.set(physChunk, 37);\n    finalHeader.set(crcChunk, 50);\n    return finalHeader;\n  }\n}\nconst b64PhysSignature1 = \"AAlwSFlz\";\nconst b64PhysSignature2 = \"AAAJcEhZ\";\nconst b64PhysSignature3 = \"AAAACXBI\";\nfunction detectPhysChunkFromDataUrl(dataUrl) {\n  let b64index = dataUrl.indexOf(b64PhysSignature1);\n  if (b64index === -1) {\n    b64index = dataUrl.indexOf(b64PhysSignature2);\n  }\n  if (b64index === -1) {\n    b64index = dataUrl.indexOf(b64PhysSignature3);\n  }\n  return b64index;\n}\n\nconst PREFIX = \"[modern-screenshot]\";\nconst IN_BROWSER = typeof window !== \"undefined\";\nconst SUPPORT_WEB_WORKER = IN_BROWSER && \"Worker\" in window;\nconst SUPPORT_ATOB = IN_BROWSER && \"atob\" in window;\nconst SUPPORT_BTOA = IN_BROWSER && \"btoa\" in window;\nconst USER_AGENT = IN_BROWSER ? window.navigator?.userAgent : \"\";\nconst IN_CHROME = USER_AGENT.includes(\"Chrome\");\nconst IN_SAFARI = USER_AGENT.includes(\"AppleWebKit\") && !IN_CHROME;\nconst IN_FIREFOX = USER_AGENT.includes(\"Firefox\");\nconst isContext = (value) => value && \"__CONTEXT__\" in value;\nconst isCssFontFaceRule = (rule) => rule.constructor.name === \"CSSFontFaceRule\";\nconst isCSSImportRule = (rule) => rule.constructor.name === \"CSSImportRule\";\nconst isElementNode = (node) => node.nodeType === 1;\nconst isSVGElementNode = (node) => typeof node.className === \"object\";\nconst isSVGImageElementNode = (node) => node.tagName === \"image\";\nconst isSVGUseElementNode = (node) => node.tagName === \"use\";\nconst isHTMLElementNode = (node) => isElementNode(node) && typeof node.style !== \"undefined\" && !isSVGElementNode(node);\nconst isCommentNode = (node) => node.nodeType === 8;\nconst isTextNode = (node) => node.nodeType === 3;\nconst isImageElement = (node) => node.tagName === \"IMG\";\nconst isVideoElement = (node) => node.tagName === \"VIDEO\";\nconst isCanvasElement = (node) => node.tagName === \"CANVAS\";\nconst isTextareaElement = (node) => node.tagName === \"TEXTAREA\";\nconst isInputElement = (node) => node.tagName === \"INPUT\";\nconst isStyleElement = (node) => node.tagName === \"STYLE\";\nconst isScriptElement = (node) => node.tagName === \"SCRIPT\";\nconst isSelectElement = (node) => node.tagName === \"SELECT\";\nconst isSlotElement = (node) => node.tagName === \"SLOT\";\nconst isIFrameElement = (node) => node.tagName === \"IFRAME\";\nconst consoleWarn = (...args) => console.warn(PREFIX, ...args);\nfunction supportWebp(ownerDocument) {\n  const canvas = ownerDocument?.createElement?.(\"canvas\");\n  if (canvas) {\n    canvas.height = canvas.width = 1;\n  }\n  return Boolean(canvas) && \"toDataURL\" in canvas && Boolean(canvas.toDataURL(\"image/webp\").includes(\"image/webp\"));\n}\nconst isDataUrl = (url) => url.startsWith(\"data:\");\nfunction resolveUrl(url, baseUrl) {\n  if (url.match(/^[a-z]+:\\/\\//i))\n    return url;\n  if (IN_BROWSER && url.match(/^\\/\\//))\n    return window.location.protocol + url;\n  if (url.match(/^[a-z]+:/i))\n    return url;\n  if (!IN_BROWSER)\n    return url;\n  const doc = getDocument().implementation.createHTMLDocument();\n  const base = doc.createElement(\"base\");\n  const a = doc.createElement(\"a\");\n  doc.head.appendChild(base);\n  doc.body.appendChild(a);\n  if (baseUrl)\n    base.href = baseUrl;\n  a.href = url;\n  return a.href;\n}\nfunction getDocument(target) {\n  return (target && isElementNode(target) ? target?.ownerDocument : target) ?? window.document;\n}\nconst XMLNS = \"http://www.w3.org/2000/svg\";\nfunction createSvg(width, height, ownerDocument) {\n  const svg = getDocument(ownerDocument).createElementNS(XMLNS, \"svg\");\n  svg.setAttributeNS(null, \"width\", width.toString());\n  svg.setAttributeNS(null, \"height\", height.toString());\n  svg.setAttributeNS(null, \"viewBox\", `0 0 ${width} ${height}`);\n  return svg;\n}\nfunction svgToDataUrl(svg, removeControlCharacter) {\n  let xhtml = new XMLSerializer().serializeToString(svg);\n  if (removeControlCharacter) {\n    xhtml = xhtml.replace(/[\\u0000-\\u0008\\v\\f\\u000E-\\u001F\\uD800-\\uDFFF\\uFFFE\\uFFFF]/gu, \"\");\n  }\n  return `data:image/svg+xml;charset=utf-8,${encodeURIComponent(xhtml)}`;\n}\nasync function canvasToBlob(canvas, type = \"image/png\", quality = 1) {\n  try {\n    return await new Promise((resolve, reject) => {\n      canvas.toBlob((blob) => {\n        if (blob) {\n          resolve(blob);\n        } else {\n          reject(new Error(\"Blob is null\"));\n        }\n      }, type, quality);\n    });\n  } catch (error) {\n    if (SUPPORT_ATOB) {\n      return dataUrlToBlob(canvas.toDataURL(type, quality));\n    }\n    throw error;\n  }\n}\nfunction dataUrlToBlob(dataUrl) {\n  const [header, base64] = dataUrl.split(\",\");\n  const type = header.match(/data:(.+);/)?.[1] ?? void 0;\n  const decoded = window.atob(base64);\n  const length = decoded.length;\n  const buffer = new Uint8Array(length);\n  for (let i = 0; i < length; i += 1) {\n    buffer[i] = decoded.charCodeAt(i);\n  }\n  return new Blob([buffer], { type });\n}\nfunction readBlob(blob, type) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = () => reject(reader.error);\n    reader.onabort = () => reject(new Error(`Failed read blob to ${type}`));\n    if (type === \"dataUrl\") {\n      reader.readAsDataURL(blob);\n    } else if (type === \"arrayBuffer\") {\n      reader.readAsArrayBuffer(blob);\n    }\n  });\n}\nconst blobToDataUrl = (blob) => readBlob(blob, \"dataUrl\");\nconst blobToArrayBuffer = (blob) => readBlob(blob, \"arrayBuffer\");\nfunction createImage(url, ownerDocument) {\n  const img = getDocument(ownerDocument).createElement(\"img\");\n  img.decoding = \"sync\";\n  img.loading = \"eager\";\n  img.src = url;\n  return img;\n}\nfunction loadMedia(media, options) {\n  return new Promise((resolve) => {\n    const { timeout, ownerDocument, onError: userOnError, onWarn } = options ?? {};\n    const node = typeof media === \"string\" ? createImage(media, getDocument(ownerDocument)) : media;\n    let timer = null;\n    let removeEventListeners = null;\n    function onResolve() {\n      resolve(node);\n      timer && clearTimeout(timer);\n      removeEventListeners?.();\n    }\n    if (timeout) {\n      timer = setTimeout(onResolve, timeout);\n    }\n    if (isVideoElement(node)) {\n      const currentSrc = node.currentSrc || node.src;\n      if (!currentSrc) {\n        if (node.poster) {\n          return loadMedia(node.poster, options).then(resolve);\n        }\n        return onResolve();\n      }\n      if (node.readyState >= 2) {\n        return onResolve();\n      }\n      const onLoadeddata = onResolve;\n      const onError = (error) => {\n        onWarn?.(\n          \"Failed video load\",\n          currentSrc,\n          error\n        );\n        userOnError?.(error);\n        onResolve();\n      };\n      removeEventListeners = () => {\n        node.removeEventListener(\"loadeddata\", onLoadeddata);\n        node.removeEventListener(\"error\", onError);\n      };\n      node.addEventListener(\"loadeddata\", onLoadeddata, { once: true });\n      node.addEventListener(\"error\", onError, { once: true });\n    } else {\n      const currentSrc = isSVGImageElementNode(node) ? node.href.baseVal : node.currentSrc || node.src;\n      if (!currentSrc) {\n        return onResolve();\n      }\n      const onLoad = async () => {\n        if (isImageElement(node) && \"decode\" in node) {\n          try {\n            await node.decode();\n          } catch (error) {\n            onWarn?.(\n              \"Failed to decode image, trying to render anyway\",\n              node.dataset.originalSrc || currentSrc,\n              error\n            );\n          }\n        }\n        onResolve();\n      };\n      const onError = (error) => {\n        onWarn?.(\n          \"Failed image load\",\n          node.dataset.originalSrc || currentSrc,\n          error\n        );\n        onResolve();\n      };\n      if (isImageElement(node) && node.complete) {\n        return onLoad();\n      }\n      removeEventListeners = () => {\n        node.removeEventListener(\"load\", onLoad);\n        node.removeEventListener(\"error\", onError);\n      };\n      node.addEventListener(\"load\", onLoad, { once: true });\n      node.addEventListener(\"error\", onError, { once: true });\n    }\n  });\n}\nasync function waitUntilLoad(node, options) {\n  if (isHTMLElementNode(node)) {\n    if (isImageElement(node) || isVideoElement(node)) {\n      await loadMedia(node, options);\n    } else {\n      await Promise.all(\n        [\"img\", \"video\"].flatMap((selectors) => {\n          return Array.from(node.querySelectorAll(selectors)).map((el) => loadMedia(el, options));\n        })\n      );\n    }\n  }\n}\nconst uuid = /* @__PURE__ */ function uuid2() {\n  let counter = 0;\n  const random = () => `0000${(Math.random() * 36 ** 4 << 0).toString(36)}`.slice(-4);\n  return () => {\n    counter += 1;\n    return `u${random()}${counter}`;\n  };\n}();\nfunction splitFontFamily(fontFamily) {\n  return fontFamily?.split(\",\").map((val) => val.trim().replace(/\"|'/g, \"\").toLowerCase()).filter(Boolean);\n}\n\nfunction createLogger(debug) {\n  return {\n    // eslint-disable-next-line no-console\n    time: (label) => debug && console.time(`${PREFIX} ${label}`),\n    // eslint-disable-next-line no-console\n    timeEnd: (label) => debug && console.timeEnd(`${PREFIX} ${label}`),\n    warn: (...args) => debug && consoleWarn(...args)\n  };\n}\n\nfunction getDefaultRequestInit(bypassingCache) {\n  return {\n    cache: bypassingCache ? \"no-cache\" : \"force-cache\"\n  };\n}\n\nasync function orCreateContext(node, options) {\n  return isContext(node) ? node : createContext(node, { ...options, autoDestruct: true });\n}\nasync function createContext(node, options) {\n  const { scale = 1, workerUrl, workerNumber = 1 } = options || {};\n  const debug = Boolean(options?.debug);\n  const features = options?.features ?? true;\n  const ownerDocument = node.ownerDocument ?? (IN_BROWSER ? window.document : void 0);\n  const ownerWindow = node.ownerDocument?.defaultView ?? (IN_BROWSER ? window : void 0);\n  const requests = /* @__PURE__ */ new Map();\n  const context = {\n    // Options\n    width: 0,\n    height: 0,\n    quality: 1,\n    type: \"image/png\",\n    scale,\n    backgroundColor: null,\n    style: null,\n    filter: null,\n    maximumCanvasSize: 0,\n    timeout: 3e4,\n    progress: null,\n    debug,\n    fetch: {\n      requestInit: getDefaultRequestInit(options?.fetch?.bypassingCache),\n      placeholderImage: \"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\",\n      bypassingCache: false,\n      ...options?.fetch\n    },\n    fetchFn: null,\n    font: {},\n    drawImageInterval: 100,\n    workerUrl: null,\n    workerNumber,\n    onCloneNode: null,\n    onEmbedNode: null,\n    onCreateForeignObjectSvg: null,\n    includeStyleProperties: null,\n    autoDestruct: false,\n    ...options,\n    // InternalContext\n    __CONTEXT__: true,\n    log: createLogger(debug),\n    node,\n    ownerDocument,\n    ownerWindow,\n    dpi: scale === 1 ? null : 96 * scale,\n    svgStyleElement: createStyleElement(ownerDocument),\n    svgDefsElement: ownerDocument?.createElementNS(XMLNS, \"defs\"),\n    svgStyles: /* @__PURE__ */ new Map(),\n    defaultComputedStyles: /* @__PURE__ */ new Map(),\n    workers: [\n      ...Array.from({\n        length: SUPPORT_WEB_WORKER && workerUrl && workerNumber ? workerNumber : 0\n      })\n    ].map(() => {\n      try {\n        const worker = new Worker(workerUrl);\n        worker.onmessage = async (event) => {\n          const { url, result } = event.data;\n          if (result) {\n            requests.get(url)?.resolve?.(result);\n          } else {\n            requests.get(url)?.reject?.(new Error(`Error receiving message from worker: ${url}`));\n          }\n        };\n        worker.onmessageerror = (event) => {\n          const { url } = event.data;\n          requests.get(url)?.reject?.(new Error(`Error receiving message from worker: ${url}`));\n        };\n        return worker;\n      } catch (error) {\n        context.log.warn(\"Failed to new Worker\", error);\n        return null;\n      }\n    }).filter(Boolean),\n    fontFamilies: /* @__PURE__ */ new Map(),\n    fontCssTexts: /* @__PURE__ */ new Map(),\n    acceptOfImage: `${[\n      supportWebp(ownerDocument) && \"image/webp\",\n      \"image/svg+xml\",\n      \"image/*\",\n      \"*/*\"\n    ].filter(Boolean).join(\",\")};q=0.8`,\n    requests,\n    drawImageCount: 0,\n    tasks: [],\n    features,\n    isEnable: (key) => {\n      if (key === \"restoreScrollPosition\") {\n        return typeof features === \"boolean\" ? false : features[key] ?? false;\n      }\n      if (typeof features === \"boolean\") {\n        return features;\n      }\n      return features[key] ?? true;\n    }\n  };\n  context.log.time(\"wait until load\");\n  await waitUntilLoad(node, { timeout: context.timeout, onWarn: context.log.warn });\n  context.log.timeEnd(\"wait until load\");\n  const { width, height } = resolveBoundingBox(node, context);\n  context.width = width;\n  context.height = height;\n  return context;\n}\nfunction createStyleElement(ownerDocument) {\n  if (!ownerDocument)\n    return void 0;\n  const style = ownerDocument.createElement(\"style\");\n  const cssText = style.ownerDocument.createTextNode(`\n.______background-clip--text {\n  background-clip: text;\n  -webkit-background-clip: text;\n}\n`);\n  style.appendChild(cssText);\n  return style;\n}\nfunction resolveBoundingBox(node, context) {\n  let { width, height } = context;\n  if (isElementNode(node) && (!width || !height)) {\n    const box = node.getBoundingClientRect();\n    width = width || box.width || Number(node.getAttribute(\"width\")) || 0;\n    height = height || box.height || Number(node.getAttribute(\"height\")) || 0;\n  }\n  return { width, height };\n}\n\nasync function imageToCanvas(image, context) {\n  const {\n    log,\n    timeout,\n    drawImageCount,\n    drawImageInterval\n  } = context;\n  log.time(\"image to canvas\");\n  const loaded = await loadMedia(image, { timeout, onWarn: context.log.warn });\n  const { canvas, context2d } = createCanvas(image.ownerDocument, context);\n  const drawImage = () => {\n    try {\n      context2d?.drawImage(loaded, 0, 0, canvas.width, canvas.height);\n    } catch (error) {\n      context.log.warn(\"Failed to drawImage\", error);\n    }\n  };\n  drawImage();\n  if (context.isEnable(\"fixSvgXmlDecode\")) {\n    for (let i = 0; i < drawImageCount; i++) {\n      await new Promise((resolve) => {\n        setTimeout(() => {\n          drawImage();\n          resolve();\n        }, i + drawImageInterval);\n      });\n    }\n  }\n  context.drawImageCount = 0;\n  log.timeEnd(\"image to canvas\");\n  return canvas;\n}\nfunction createCanvas(ownerDocument, context) {\n  const { width, height, scale, backgroundColor, maximumCanvasSize: max } = context;\n  const canvas = ownerDocument.createElement(\"canvas\");\n  canvas.width = Math.floor(width * scale);\n  canvas.height = Math.floor(height * scale);\n  canvas.style.width = `${width}px`;\n  canvas.style.height = `${height}px`;\n  if (max) {\n    if (canvas.width > max || canvas.height > max) {\n      if (canvas.width > max && canvas.height > max) {\n        if (canvas.width > canvas.height) {\n          canvas.height *= max / canvas.width;\n          canvas.width = max;\n        } else {\n          canvas.width *= max / canvas.height;\n          canvas.height = max;\n        }\n      } else if (canvas.width > max) {\n        canvas.height *= max / canvas.width;\n        canvas.width = max;\n      } else {\n        canvas.width *= max / canvas.height;\n        canvas.height = max;\n      }\n    }\n  }\n  const context2d = canvas.getContext(\"2d\");\n  if (context2d && backgroundColor) {\n    context2d.fillStyle = backgroundColor;\n    context2d.fillRect(0, 0, canvas.width, canvas.height);\n  }\n  return { canvas, context2d };\n}\n\nfunction cloneCanvas(canvas, context) {\n  if (canvas.ownerDocument) {\n    try {\n      const dataURL = canvas.toDataURL();\n      if (dataURL !== \"data:,\") {\n        return createImage(dataURL, canvas.ownerDocument);\n      }\n    } catch (error) {\n      context.log.warn(\"Failed to clone canvas\", error);\n    }\n  }\n  const cloned = canvas.cloneNode(false);\n  const ctx = canvas.getContext(\"2d\");\n  const clonedCtx = cloned.getContext(\"2d\");\n  try {\n    if (ctx && clonedCtx) {\n      clonedCtx.putImageData(\n        ctx.getImageData(0, 0, canvas.width, canvas.height),\n        0,\n        0\n      );\n    }\n    return cloned;\n  } catch (error) {\n    context.log.warn(\"Failed to clone canvas\", error);\n  }\n  return cloned;\n}\n\nfunction cloneIframe(iframe, context) {\n  try {\n    if (iframe?.contentDocument?.body) {\n      return cloneNode(iframe.contentDocument.body, context);\n    }\n  } catch (error) {\n    context.log.warn(\"Failed to clone iframe\", error);\n  }\n  return iframe.cloneNode(false);\n}\n\nfunction cloneImage(image) {\n  const cloned = image.cloneNode(false);\n  if (image.currentSrc && image.currentSrc !== image.src) {\n    cloned.src = image.currentSrc;\n    cloned.srcset = \"\";\n  }\n  if (cloned.loading === \"lazy\") {\n    cloned.loading = \"eager\";\n  }\n  return cloned;\n}\n\nasync function cloneVideo(video, context) {\n  if (video.ownerDocument && !video.currentSrc && video.poster) {\n    return createImage(video.poster, video.ownerDocument);\n  }\n  const cloned = video.cloneNode(false);\n  cloned.crossOrigin = \"anonymous\";\n  if (video.currentSrc && video.currentSrc !== video.src) {\n    cloned.src = video.currentSrc;\n  }\n  const ownerDocument = cloned.ownerDocument;\n  if (ownerDocument) {\n    let canPlay = true;\n    await loadMedia(cloned, { onError: () => canPlay = false, onWarn: context.log.warn });\n    if (!canPlay) {\n      if (video.poster) {\n        return createImage(video.poster, video.ownerDocument);\n      }\n      return cloned;\n    }\n    cloned.currentTime = video.currentTime;\n    await new Promise((resolve) => {\n      cloned.addEventListener(\"seeked\", resolve, { once: true });\n    });\n    const canvas = ownerDocument.createElement(\"canvas\");\n    canvas.width = video.offsetWidth;\n    canvas.height = video.offsetHeight;\n    try {\n      const ctx = canvas.getContext(\"2d\");\n      if (ctx)\n        ctx.drawImage(cloned, 0, 0, canvas.width, canvas.height);\n    } catch (error) {\n      context.log.warn(\"Failed to clone video\", error);\n      if (video.poster) {\n        return createImage(video.poster, video.ownerDocument);\n      }\n      return cloned;\n    }\n    return cloneCanvas(canvas, context);\n  }\n  return cloned;\n}\n\nfunction cloneElement(node, context) {\n  if (isCanvasElement(node)) {\n    return cloneCanvas(node, context);\n  }\n  if (isIFrameElement(node)) {\n    return cloneIframe(node, context);\n  }\n  if (isImageElement(node)) {\n    return cloneImage(node);\n  }\n  if (isVideoElement(node)) {\n    return cloneVideo(node, context);\n  }\n  return node.cloneNode(false);\n}\n\nfunction getSandBox(context) {\n  let sandbox = context.sandbox;\n  if (!sandbox) {\n    const { ownerDocument } = context;\n    try {\n      if (ownerDocument) {\n        sandbox = ownerDocument.createElement(\"iframe\");\n        sandbox.id = `__SANDBOX__-${uuid()}`;\n        sandbox.width = \"0\";\n        sandbox.height = \"0\";\n        sandbox.style.visibility = \"hidden\";\n        sandbox.style.position = \"fixed\";\n        ownerDocument.body.appendChild(sandbox);\n        sandbox.contentWindow?.document.write('<!DOCTYPE html><meta charset=\"UTF-8\"><title></title><body>');\n        context.sandbox = sandbox;\n      }\n    } catch (error) {\n      context.log.warn(\"Failed to getSandBox\", error);\n    }\n  }\n  return sandbox;\n}\n\nconst ignoredStyles = [\n  \"width\",\n  \"height\",\n  \"-webkit-text-fill-color\"\n];\nconst includedAttributes = [\n  \"stroke\",\n  \"fill\"\n];\nfunction getDefaultStyle(node, pseudoElement, context) {\n  const { defaultComputedStyles } = context;\n  const nodeName = node.nodeName.toLowerCase();\n  const isSvgNode = isSVGElementNode(node) && nodeName !== \"svg\";\n  const attributes = isSvgNode ? includedAttributes.map((name) => [name, node.getAttribute(name)]).filter(([, value]) => value !== null) : [];\n  const key = [\n    isSvgNode && \"svg\",\n    nodeName,\n    attributes.map((name, value) => `${name}=${value}`).join(\",\"),\n    pseudoElement\n  ].filter(Boolean).join(\":\");\n  if (defaultComputedStyles.has(key))\n    return defaultComputedStyles.get(key);\n  const sandbox = getSandBox(context);\n  const sandboxWindow = sandbox?.contentWindow;\n  if (!sandboxWindow)\n    return /* @__PURE__ */ new Map();\n  const sandboxDocument = sandboxWindow?.document;\n  let root;\n  let el;\n  if (isSvgNode) {\n    root = sandboxDocument.createElementNS(XMLNS, \"svg\");\n    el = root.ownerDocument.createElementNS(root.namespaceURI, nodeName);\n    attributes.forEach(([name, value]) => {\n      el.setAttributeNS(null, name, value);\n    });\n    root.appendChild(el);\n  } else {\n    root = el = sandboxDocument.createElement(nodeName);\n  }\n  el.textContent = \" \";\n  sandboxDocument.body.appendChild(root);\n  const computedStyle = sandboxWindow.getComputedStyle(el, pseudoElement);\n  const styles = /* @__PURE__ */ new Map();\n  for (let len = computedStyle.length, i = 0; i < len; i++) {\n    const name = computedStyle.item(i);\n    if (ignoredStyles.includes(name))\n      continue;\n    styles.set(name, computedStyle.getPropertyValue(name));\n  }\n  sandboxDocument.body.removeChild(root);\n  defaultComputedStyles.set(key, styles);\n  return styles;\n}\n\nfunction getDiffStyle(style, defaultStyle, includeStyleProperties) {\n  const diffStyle = /* @__PURE__ */ new Map();\n  const prefixs = [];\n  const prefixTree = /* @__PURE__ */ new Map();\n  if (includeStyleProperties) {\n    for (const name of includeStyleProperties) {\n      applyTo(name);\n    }\n  } else {\n    for (let len = style.length, i = 0; i < len; i++) {\n      const name = style.item(i);\n      applyTo(name);\n    }\n  }\n  for (let len = prefixs.length, i = 0; i < len; i++) {\n    prefixTree.get(prefixs[i])?.forEach((value, name) => diffStyle.set(name, value));\n  }\n  function applyTo(name) {\n    const value = style.getPropertyValue(name);\n    const priority = style.getPropertyPriority(name);\n    const subIndex = name.lastIndexOf(\"-\");\n    const prefix = subIndex > -1 ? name.substring(0, subIndex) : void 0;\n    if (prefix) {\n      let map = prefixTree.get(prefix);\n      if (!map) {\n        map = /* @__PURE__ */ new Map();\n        prefixTree.set(prefix, map);\n      }\n      map.set(name, [value, priority]);\n    }\n    if (defaultStyle.get(name) === value && !priority)\n      return;\n    if (prefix) {\n      prefixs.push(prefix);\n    } else {\n      diffStyle.set(name, [value, priority]);\n    }\n  }\n  return diffStyle;\n}\n\nfunction copyCssStyles(node, cloned, isRoot, context) {\n  const { ownerWindow, includeStyleProperties, currentParentNodeStyle } = context;\n  const clonedStyle = cloned.style;\n  const computedStyle = ownerWindow.getComputedStyle(node);\n  const defaultStyle = getDefaultStyle(node, null, context);\n  currentParentNodeStyle?.forEach((_, key) => {\n    defaultStyle.delete(key);\n  });\n  const style = getDiffStyle(computedStyle, defaultStyle, includeStyleProperties);\n  style.delete(\"transition-property\");\n  style.delete(\"all\");\n  style.delete(\"d\");\n  style.delete(\"content\");\n  if (isRoot) {\n    style.delete(\"margin-top\");\n    style.delete(\"margin-right\");\n    style.delete(\"margin-bottom\");\n    style.delete(\"margin-left\");\n    style.delete(\"margin-block-start\");\n    style.delete(\"margin-block-end\");\n    style.delete(\"margin-inline-start\");\n    style.delete(\"margin-inline-end\");\n    style.set(\"box-sizing\", [\"border-box\", \"\"]);\n  }\n  if (style.get(\"background-clip\")?.[0] === \"text\") {\n    cloned.classList.add(\"______background-clip--text\");\n  }\n  if (IN_CHROME) {\n    if (!style.has(\"font-kerning\"))\n      style.set(\"font-kerning\", [\"normal\", \"\"]);\n    if ((style.get(\"overflow-x\")?.[0] === \"hidden\" || style.get(\"overflow-y\")?.[0] === \"hidden\") && style.get(\"text-overflow\")?.[0] === \"ellipsis\" && node.scrollWidth === node.clientWidth) {\n      style.set(\"text-overflow\", [\"clip\", \"\"]);\n    }\n  }\n  style.forEach(([value, priority], name) => {\n    clonedStyle.setProperty(name, value, priority);\n  });\n  return style;\n}\n\nfunction copyInputValue(node, cloned) {\n  if (isTextareaElement(node)) {\n    cloned.innerHTML = node.value;\n  }\n  if (isTextareaElement(node) || isInputElement(node) || isSelectElement(node)) {\n    cloned.setAttribute(\"value\", node.value);\n  }\n}\n\nconst pseudoClasses = [\n  \":before\",\n  \":after\"\n  // ':placeholder', TODO\n];\nconst scrollbarPseudoClasses = [\n  \":-webkit-scrollbar\",\n  \":-webkit-scrollbar-button\",\n  // ':-webkit-scrollbar:horizontal', TODO\n  \":-webkit-scrollbar-thumb\",\n  \":-webkit-scrollbar-track\",\n  \":-webkit-scrollbar-track-piece\",\n  // ':-webkit-scrollbar:vertical', TODO\n  \":-webkit-scrollbar-corner\",\n  \":-webkit-resizer\"\n];\nfunction copyPseudoClass(node, cloned, copyScrollbar, context, addWordToFontFamilies) {\n  const { ownerWindow, svgStyleElement, svgStyles, currentNodeStyle } = context;\n  if (!svgStyleElement || !ownerWindow)\n    return;\n  function copyBy(pseudoClass) {\n    const computedStyle = ownerWindow.getComputedStyle(node, pseudoClass);\n    let content = computedStyle.getPropertyValue(\"content\");\n    if (!content || content === \"none\")\n      return;\n    addWordToFontFamilies?.(content);\n    content = content.replace(/(')|(\")|(counter\\(.+\\))/g, \"\");\n    const klasses = [uuid()];\n    const defaultStyle = getDefaultStyle(node, pseudoClass, context);\n    currentNodeStyle?.forEach((_, key) => {\n      defaultStyle.delete(key);\n    });\n    const style = getDiffStyle(computedStyle, defaultStyle, context.includeStyleProperties);\n    style.delete(\"content\");\n    style.delete(\"-webkit-locale\");\n    if (style.get(\"background-clip\")?.[0] === \"text\") {\n      cloned.classList.add(\"______background-clip--text\");\n    }\n    const cloneStyle = [\n      `content: '${content}';`\n    ];\n    style.forEach(([value, priority], name) => {\n      cloneStyle.push(`${name}: ${value}${priority ? \" !important\" : \"\"};`);\n    });\n    if (cloneStyle.length === 1)\n      return;\n    try {\n      cloned.className = [cloned.className, ...klasses].join(\" \");\n    } catch (err) {\n      context.log.warn(\"Failed to copyPseudoClass\", err);\n      return;\n    }\n    const cssText = cloneStyle.join(\"\\n  \");\n    let allClasses = svgStyles.get(cssText);\n    if (!allClasses) {\n      allClasses = [];\n      svgStyles.set(cssText, allClasses);\n    }\n    allClasses.push(`.${klasses[0]}:${pseudoClass}`);\n  }\n  pseudoClasses.forEach(copyBy);\n  if (copyScrollbar)\n    scrollbarPseudoClasses.forEach(copyBy);\n}\n\nconst excludeParentNodes = /* @__PURE__ */ new Set([\n  \"symbol\"\n  // test/fixtures/svg.symbol.html\n]);\nasync function appendChildNode(node, cloned, child, context, addWordToFontFamilies) {\n  if (isElementNode(child) && (isStyleElement(child) || isScriptElement(child)))\n    return;\n  if (context.filter && !context.filter(child))\n    return;\n  if (excludeParentNodes.has(cloned.nodeName) || excludeParentNodes.has(child.nodeName)) {\n    context.currentParentNodeStyle = void 0;\n  } else {\n    context.currentParentNodeStyle = context.currentNodeStyle;\n  }\n  const childCloned = await cloneNode(child, context, false, addWordToFontFamilies);\n  if (context.isEnable(\"restoreScrollPosition\")) {\n    restoreScrollPosition(node, childCloned);\n  }\n  cloned.appendChild(childCloned);\n}\nasync function cloneChildNodes(node, cloned, context, addWordToFontFamilies) {\n  const firstChild = (isElementNode(node) ? node.shadowRoot?.firstChild : void 0) ?? node.firstChild;\n  for (let child = firstChild; child; child = child.nextSibling) {\n    if (isCommentNode(child))\n      continue;\n    if (isElementNode(child) && isSlotElement(child) && typeof child.assignedNodes === \"function\") {\n      const nodes = child.assignedNodes();\n      for (let i = 0; i < nodes.length; i++) {\n        await appendChildNode(node, cloned, nodes[i], context, addWordToFontFamilies);\n      }\n    } else {\n      await appendChildNode(node, cloned, child, context, addWordToFontFamilies);\n    }\n  }\n}\nfunction restoreScrollPosition(node, chlidCloned) {\n  if (!isHTMLElementNode(node) || !isHTMLElementNode(chlidCloned))\n    return;\n  const { scrollTop, scrollLeft } = node;\n  if (!scrollTop && !scrollLeft) {\n    return;\n  }\n  const { transform } = chlidCloned.style;\n  const matrix = new DOMMatrix(transform);\n  const { a, b, c, d } = matrix;\n  matrix.a = 1;\n  matrix.b = 0;\n  matrix.c = 0;\n  matrix.d = 1;\n  matrix.translateSelf(-scrollLeft, -scrollTop);\n  matrix.a = a;\n  matrix.b = b;\n  matrix.c = c;\n  matrix.d = d;\n  chlidCloned.style.transform = matrix.toString();\n}\nfunction applyCssStyleWithOptions(cloned, context) {\n  const { backgroundColor, width, height, style: styles } = context;\n  const clonedStyle = cloned.style;\n  if (backgroundColor)\n    clonedStyle.setProperty(\"background-color\", backgroundColor, \"important\");\n  if (width)\n    clonedStyle.setProperty(\"width\", `${width}px`, \"important\");\n  if (height)\n    clonedStyle.setProperty(\"height\", `${height}px`, \"important\");\n  if (styles) {\n    for (const name in styles)\n      clonedStyle[name] = styles[name];\n  }\n}\nconst NORMAL_ATTRIBUTE_RE = /^[\\w-:]+$/;\nasync function cloneNode(node, context, isRoot = false, addWordToFontFamilies) {\n  const { ownerDocument, ownerWindow, fontFamilies } = context;\n  if (ownerDocument && isTextNode(node)) {\n    if (addWordToFontFamilies && /\\S/.test(node.data)) {\n      addWordToFontFamilies(node.data);\n    }\n    return ownerDocument.createTextNode(node.data);\n  }\n  if (ownerDocument && ownerWindow && isElementNode(node) && (isHTMLElementNode(node) || isSVGElementNode(node))) {\n    const cloned2 = await cloneElement(node, context);\n    if (context.isEnable(\"removeAbnormalAttributes\")) {\n      const names = cloned2.getAttributeNames();\n      for (let len = names.length, i = 0; i < len; i++) {\n        const name = names[i];\n        if (!NORMAL_ATTRIBUTE_RE.test(name)) {\n          cloned2.removeAttribute(name);\n        }\n      }\n    }\n    const style = context.currentNodeStyle = copyCssStyles(node, cloned2, isRoot, context);\n    if (isRoot)\n      applyCssStyleWithOptions(cloned2, context);\n    let copyScrollbar = false;\n    if (context.isEnable(\"copyScrollbar\")) {\n      const overflow = [\n        style.get(\"overflow-x\")?.[0],\n        style.get(\"overflow-y\")?.[1]\n      ];\n      copyScrollbar = overflow.includes(\"scroll\") || (overflow.includes(\"auto\") || overflow.includes(\"overlay\")) && (node.scrollHeight > node.clientHeight || node.scrollWidth > node.clientWidth);\n    }\n    const textTransform = style.get(\"text-transform\")?.[0];\n    const families = splitFontFamily(style.get(\"font-family\")?.[0]);\n    const addWordToFontFamilies2 = families ? (word) => {\n      if (textTransform === \"uppercase\") {\n        word = word.toUpperCase();\n      } else if (textTransform === \"lowercase\") {\n        word = word.toLowerCase();\n      } else if (textTransform === \"capitalize\") {\n        word = word[0].toUpperCase() + word.substring(1);\n      }\n      families.forEach((family) => {\n        let fontFamily = fontFamilies.get(family);\n        if (!fontFamily) {\n          fontFamilies.set(family, fontFamily = /* @__PURE__ */ new Set());\n        }\n        word.split(\"\").forEach((text) => fontFamily.add(text));\n      });\n    } : void 0;\n    copyPseudoClass(\n      node,\n      cloned2,\n      copyScrollbar,\n      context,\n      addWordToFontFamilies2\n    );\n    copyInputValue(node, cloned2);\n    if (!isVideoElement(node)) {\n      await cloneChildNodes(\n        node,\n        cloned2,\n        context,\n        addWordToFontFamilies2\n      );\n    }\n    return cloned2;\n  }\n  const cloned = node.cloneNode(false);\n  await cloneChildNodes(node, cloned, context);\n  return cloned;\n}\n\nfunction destroyContext(context) {\n  context.ownerDocument = void 0;\n  context.ownerWindow = void 0;\n  context.svgStyleElement = void 0;\n  context.svgDefsElement = void 0;\n  context.svgStyles.clear();\n  context.defaultComputedStyles.clear();\n  if (context.sandbox) {\n    try {\n      context.sandbox.remove();\n    } catch (err) {\n      context.log.warn(\"Failed to destroyContext\", err);\n    }\n    context.sandbox = void 0;\n  }\n  context.workers = [];\n  context.fontFamilies.clear();\n  context.fontCssTexts.clear();\n  context.requests.clear();\n  context.tasks = [];\n}\n\nfunction baseFetch(options) {\n  const { url, timeout, responseType, ...requestInit } = options;\n  const controller = new AbortController();\n  const timer = timeout ? setTimeout(() => controller.abort(), timeout) : void 0;\n  return fetch(url, { signal: controller.signal, ...requestInit }).then((response) => {\n    if (!response.ok) {\n      throw new Error(\"Failed fetch, not 2xx response\", { cause: response });\n    }\n    switch (responseType) {\n      case \"arrayBuffer\":\n        return response.arrayBuffer();\n      case \"dataUrl\":\n        return response.blob().then(blobToDataUrl);\n      case \"text\":\n      default:\n        return response.text();\n    }\n  }).finally(() => clearTimeout(timer));\n}\nfunction contextFetch(context, options) {\n  const { url: rawUrl, requestType = \"text\", responseType = \"text\", imageDom } = options;\n  let url = rawUrl;\n  const {\n    timeout,\n    acceptOfImage,\n    requests,\n    fetchFn,\n    fetch: {\n      requestInit,\n      bypassingCache,\n      placeholderImage\n    },\n    font,\n    workers,\n    fontFamilies\n  } = context;\n  if (requestType === \"image\" && (IN_SAFARI || IN_FIREFOX)) {\n    context.drawImageCount++;\n  }\n  let request = requests.get(rawUrl);\n  if (!request) {\n    if (bypassingCache) {\n      if (bypassingCache instanceof RegExp && bypassingCache.test(url)) {\n        url += (/\\?/.test(url) ? \"&\" : \"?\") + (/* @__PURE__ */ new Date()).getTime();\n      }\n    }\n    const canFontMinify = requestType.startsWith(\"font\") && font && font.minify;\n    const fontTexts = /* @__PURE__ */ new Set();\n    if (canFontMinify) {\n      const families = requestType.split(\";\")[1].split(\",\");\n      families.forEach((family) => {\n        if (!fontFamilies.has(family))\n          return;\n        fontFamilies.get(family).forEach((text) => fontTexts.add(text));\n      });\n    }\n    const needFontMinify = canFontMinify && fontTexts.size;\n    const baseFetchOptions = {\n      url,\n      timeout,\n      responseType: needFontMinify ? \"arrayBuffer\" : responseType,\n      headers: requestType === \"image\" ? { accept: acceptOfImage } : void 0,\n      ...requestInit\n    };\n    request = {\n      type: requestType,\n      resolve: void 0,\n      reject: void 0,\n      response: null\n    };\n    request.response = (async () => {\n      if (fetchFn && requestType === \"image\") {\n        const result = await fetchFn(rawUrl);\n        if (result)\n          return result;\n      }\n      if (!IN_SAFARI && rawUrl.startsWith(\"http\") && workers.length) {\n        return new Promise((resolve, reject) => {\n          const worker = workers[requests.size & workers.length - 1];\n          worker.postMessage({ rawUrl, ...baseFetchOptions });\n          request.resolve = resolve;\n          request.reject = reject;\n        });\n      }\n      return baseFetch(baseFetchOptions);\n    })().catch((error) => {\n      requests.delete(rawUrl);\n      if (requestType === \"image\" && placeholderImage) {\n        context.log.warn(\"Failed to fetch image base64, trying to use placeholder image\", url);\n        return typeof placeholderImage === \"string\" ? placeholderImage : placeholderImage(imageDom);\n      }\n      throw error;\n    });\n    requests.set(rawUrl, request);\n  }\n  return request.response;\n}\n\nasync function replaceCssUrlToDataUrl(cssText, baseUrl, context, isImage) {\n  if (!hasCssUrl(cssText))\n    return cssText;\n  for (const [rawUrl, url] of parseCssUrls(cssText, baseUrl)) {\n    try {\n      const dataUrl = await contextFetch(\n        context,\n        {\n          url,\n          requestType: isImage ? \"image\" : \"text\",\n          responseType: \"dataUrl\"\n        }\n      );\n      cssText = cssText.replace(toRE(rawUrl), `$1${dataUrl}$3`);\n    } catch (error) {\n      context.log.warn(\"Failed to fetch css data url\", rawUrl, error);\n    }\n  }\n  return cssText;\n}\nfunction hasCssUrl(cssText) {\n  return /url\\((['\"]?)([^'\"]+?)\\1\\)/.test(cssText);\n}\nconst URL_RE = /url\\((['\"]?)([^'\"]+?)\\1\\)/g;\nfunction parseCssUrls(cssText, baseUrl) {\n  const result = [];\n  cssText.replace(URL_RE, (raw, quotation, url) => {\n    result.push([url, resolveUrl(url, baseUrl)]);\n    return raw;\n  });\n  return result.filter(([url]) => !isDataUrl(url));\n}\nfunction toRE(url) {\n  const escaped = url.replace(/([.*+?^${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n  return new RegExp(`(url\\\\(['\"]?)(${escaped})(['\"]?\\\\))`, \"g\");\n}\n\nconst properties = [\n  \"background-image\",\n  \"border-image-source\",\n  \"-webkit-border-image\",\n  \"-webkit-mask-image\",\n  \"list-style-image\"\n];\nfunction embedCssStyleImage(style, context) {\n  return properties.map((property) => {\n    const value = style.getPropertyValue(property);\n    if (!value || value === \"none\") {\n      return null;\n    }\n    if (IN_SAFARI || IN_FIREFOX) {\n      context.drawImageCount++;\n    }\n    return replaceCssUrlToDataUrl(value, null, context, true).then((newValue) => {\n      if (!newValue || value === newValue)\n        return;\n      style.setProperty(\n        property,\n        newValue,\n        style.getPropertyPriority(property)\n      );\n    });\n  }).filter(Boolean);\n}\n\nfunction embedImageElement(cloned, context) {\n  if (isImageElement(cloned)) {\n    const originalSrc = cloned.currentSrc || cloned.src;\n    if (!isDataUrl(originalSrc)) {\n      return [\n        contextFetch(context, {\n          url: originalSrc,\n          imageDom: cloned,\n          requestType: \"image\",\n          responseType: \"dataUrl\"\n        }).then((url) => {\n          if (!url)\n            return;\n          cloned.srcset = \"\";\n          cloned.dataset.originalSrc = originalSrc;\n          cloned.src = url || \"\";\n        })\n      ];\n    }\n    if (IN_SAFARI || IN_FIREFOX) {\n      context.drawImageCount++;\n    }\n  } else if (isSVGElementNode(cloned) && !isDataUrl(cloned.href.baseVal)) {\n    const originalSrc = cloned.href.baseVal;\n    return [\n      contextFetch(context, {\n        url: originalSrc,\n        imageDom: cloned,\n        requestType: \"image\",\n        responseType: \"dataUrl\"\n      }).then((url) => {\n        if (!url)\n          return;\n        cloned.dataset.originalSrc = originalSrc;\n        cloned.href.baseVal = url || \"\";\n      })\n    ];\n  }\n  return [];\n}\n\nfunction embedSvgUse(cloned, context) {\n  const { ownerDocument, svgDefsElement } = context;\n  const href = cloned.getAttribute(\"href\") ?? cloned.getAttribute(\"xlink:href\");\n  if (!href)\n    return [];\n  const [svgUrl, id] = href.split(\"#\");\n  if (id) {\n    const query = `#${id}`;\n    const definition = ownerDocument?.querySelector(`svg ${query}`);\n    if (svgUrl) {\n      cloned.setAttribute(\"href\", query);\n    }\n    if (svgDefsElement?.querySelector(query))\n      return [];\n    if (definition) {\n      svgDefsElement?.appendChild(definition.cloneNode(true));\n      return [];\n    } else if (svgUrl) {\n      return [\n        contextFetch(context, {\n          url: svgUrl,\n          responseType: \"text\"\n        }).then((svgData) => {\n          svgDefsElement?.insertAdjacentHTML(\"beforeend\", svgData);\n        })\n      ];\n    }\n  }\n  return [];\n}\n\nfunction embedNode(cloned, context) {\n  const { tasks } = context;\n  if (isElementNode(cloned)) {\n    if (isImageElement(cloned) || isSVGImageElementNode(cloned)) {\n      tasks.push(...embedImageElement(cloned, context));\n    }\n    if (isSVGUseElementNode(cloned)) {\n      tasks.push(...embedSvgUse(cloned, context));\n    }\n  }\n  if (isHTMLElementNode(cloned)) {\n    tasks.push(...embedCssStyleImage(cloned.style, context));\n  }\n  cloned.childNodes.forEach((child) => {\n    embedNode(child, context);\n  });\n}\n\nasync function embedWebFont(clone, context) {\n  const {\n    ownerDocument,\n    svgStyleElement,\n    fontFamilies,\n    fontCssTexts,\n    tasks,\n    font\n  } = context;\n  if (!ownerDocument || !svgStyleElement || !fontFamilies.size) {\n    return;\n  }\n  if (font && font.cssText) {\n    const cssText = filterPreferredFormat(font.cssText, context);\n    svgStyleElement.appendChild(ownerDocument.createTextNode(`${cssText}\n`));\n  } else {\n    const styleSheets = Array.from(ownerDocument.styleSheets).filter((styleSheet) => {\n      try {\n        return \"cssRules\" in styleSheet && Boolean(styleSheet.cssRules.length);\n      } catch (error) {\n        context.log.warn(`Error while reading CSS rules from ${styleSheet.href}`, error);\n        return false;\n      }\n    });\n    await Promise.all(\n      styleSheets.flatMap((styleSheet) => {\n        return Array.from(styleSheet.cssRules).map(async (cssRule, index) => {\n          if (isCSSImportRule(cssRule)) {\n            let importIndex = index + 1;\n            const baseUrl = cssRule.href;\n            let cssText = \"\";\n            try {\n              cssText = await contextFetch(context, {\n                url: baseUrl,\n                requestType: \"text\",\n                responseType: \"text\"\n              });\n            } catch (error) {\n              context.log.warn(`Error fetch remote css import from ${baseUrl}`, error);\n            }\n            const replacedCssText = cssText.replace(\n              URL_RE,\n              (raw, quotation, url) => raw.replace(url, resolveUrl(url, baseUrl))\n            );\n            for (const rule of parseCss(replacedCssText)) {\n              try {\n                styleSheet.insertRule(\n                  rule,\n                  rule.startsWith(\"@import\") ? importIndex += 1 : styleSheet.cssRules.length\n                );\n              } catch (error) {\n                context.log.warn(\"Error inserting rule from remote css import\", { rule, error });\n              }\n            }\n          }\n        });\n      })\n    );\n    const cssRules = styleSheets.flatMap((styleSheet) => Array.from(styleSheet.cssRules));\n    cssRules.filter((cssRule) => isCssFontFaceRule(cssRule) && hasCssUrl(cssRule.style.getPropertyValue(\"src\")) && splitFontFamily(cssRule.style.getPropertyValue(\"font-family\"))?.some((val) => fontFamilies.has(val))).forEach((value) => {\n      const rule = value;\n      const cssText = fontCssTexts.get(rule.cssText);\n      if (cssText) {\n        svgStyleElement.appendChild(ownerDocument.createTextNode(`${cssText}\n`));\n      } else {\n        tasks.push(\n          replaceCssUrlToDataUrl(\n            rule.cssText,\n            rule.parentStyleSheet ? rule.parentStyleSheet.href : null,\n            context\n          ).then((cssText2) => {\n            cssText2 = filterPreferredFormat(cssText2, context);\n            fontCssTexts.set(rule.cssText, cssText2);\n            svgStyleElement.appendChild(ownerDocument.createTextNode(`${cssText2}\n`));\n          })\n        );\n      }\n    });\n  }\n}\nconst COMMENTS_RE = /(\\/\\*[\\s\\S]*?\\*\\/)/g;\nconst KEYFRAMES_RE = /((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})/gi;\nfunction parseCss(source) {\n  if (source == null)\n    return [];\n  const result = [];\n  let cssText = source.replace(COMMENTS_RE, \"\");\n  while (true) {\n    const matches = KEYFRAMES_RE.exec(cssText);\n    if (!matches)\n      break;\n    result.push(matches[0]);\n  }\n  cssText = cssText.replace(KEYFRAMES_RE, \"\");\n  const IMPORT_RE = /@import[\\s\\S]*?url\\([^)]*\\)[\\s\\S]*?;/gi;\n  const UNIFIED_RE = new RegExp(\n    // eslint-disable-next-line\n    \"((\\\\s*?(?:\\\\/\\\\*[\\\\s\\\\S]*?\\\\*\\\\/)?\\\\s*?@media[\\\\s\\\\S]*?){([\\\\s\\\\S]*?)}\\\\s*?})|(([\\\\s\\\\S]*?){([\\\\s\\\\S]*?)})\",\n    \"gi\"\n  );\n  while (true) {\n    let matches = IMPORT_RE.exec(cssText);\n    if (!matches) {\n      matches = UNIFIED_RE.exec(cssText);\n      if (!matches) {\n        break;\n      } else {\n        IMPORT_RE.lastIndex = UNIFIED_RE.lastIndex;\n      }\n    } else {\n      UNIFIED_RE.lastIndex = IMPORT_RE.lastIndex;\n    }\n    result.push(matches[0]);\n  }\n  return result;\n}\nconst URL_WITH_FORMAT_RE = /url\\([^)]+\\)\\s*format\\(([\"']?)([^\"']+)\\1\\)/g;\nconst FONT_SRC_RE = /src:\\s*(?:url\\([^)]+\\)\\s*format\\([^)]+\\)[,;]\\s*)+/g;\nfunction filterPreferredFormat(str, context) {\n  const { font } = context;\n  const preferredFormat = font ? font?.preferredFormat : void 0;\n  return preferredFormat ? str.replace(FONT_SRC_RE, (match) => {\n    while (true) {\n      const [src, , format] = URL_WITH_FORMAT_RE.exec(match) || [];\n      if (!format)\n        return \"\";\n      if (format === preferredFormat)\n        return `src: ${src};`;\n    }\n  }) : str;\n}\n\nasync function domToForeignObjectSvg(node, options) {\n  const context = await orCreateContext(node, options);\n  if (isElementNode(context.node) && isSVGElementNode(context.node))\n    return context.node;\n  const {\n    ownerDocument,\n    log,\n    tasks,\n    svgStyleElement,\n    svgDefsElement,\n    svgStyles,\n    font,\n    progress,\n    autoDestruct,\n    onCloneNode,\n    onEmbedNode,\n    onCreateForeignObjectSvg\n  } = context;\n  log.time(\"clone node\");\n  const clone = await cloneNode(context.node, context, true);\n  if (svgStyleElement && ownerDocument) {\n    let allCssText = \"\";\n    svgStyles.forEach((klasses, cssText) => {\n      allCssText += `${klasses.join(\",\\n\")} {\n  ${cssText}\n}\n`;\n    });\n    svgStyleElement.appendChild(ownerDocument.createTextNode(allCssText));\n  }\n  log.timeEnd(\"clone node\");\n  await onCloneNode?.(clone);\n  if (font !== false && isElementNode(clone)) {\n    log.time(\"embed web font\");\n    await embedWebFont(clone, context);\n    log.timeEnd(\"embed web font\");\n  }\n  log.time(\"embed node\");\n  embedNode(clone, context);\n  const count = tasks.length;\n  let current = 0;\n  const runTask = async () => {\n    while (true) {\n      const task = tasks.pop();\n      if (!task)\n        break;\n      try {\n        await task;\n      } catch (error) {\n        context.log.warn(\"Failed to run task\", error);\n      }\n      progress?.(++current, count);\n    }\n  };\n  progress?.(current, count);\n  await Promise.all([...Array.from({ length: 4 })].map(runTask));\n  log.timeEnd(\"embed node\");\n  await onEmbedNode?.(clone);\n  const svg = createForeignObjectSvg(clone, context);\n  svgDefsElement && svg.insertBefore(svgDefsElement, svg.children[0]);\n  svgStyleElement && svg.insertBefore(svgStyleElement, svg.children[0]);\n  autoDestruct && destroyContext(context);\n  await onCreateForeignObjectSvg?.(svg);\n  return svg;\n}\nfunction createForeignObjectSvg(clone, context) {\n  const { width, height } = context;\n  const svg = createSvg(width, height, clone.ownerDocument);\n  const foreignObject = svg.ownerDocument.createElementNS(svg.namespaceURI, \"foreignObject\");\n  foreignObject.setAttributeNS(null, \"x\", \"0%\");\n  foreignObject.setAttributeNS(null, \"y\", \"0%\");\n  foreignObject.setAttributeNS(null, \"width\", \"100%\");\n  foreignObject.setAttributeNS(null, \"height\", \"100%\");\n  foreignObject.append(clone);\n  svg.appendChild(foreignObject);\n  return svg;\n}\n\nasync function domToCanvas(node, options) {\n  const context = await orCreateContext(node, options);\n  const svg = await domToForeignObjectSvg(context);\n  const dataUrl = svgToDataUrl(svg, context.isEnable(\"removeControlCharacter\"));\n  if (!context.autoDestruct) {\n    context.svgStyleElement = createStyleElement(context.ownerDocument);\n    context.svgDefsElement = context.ownerDocument?.createElementNS(XMLNS, \"defs\");\n    context.svgStyles.clear();\n  }\n  const image = createImage(dataUrl, svg.ownerDocument);\n  return await imageToCanvas(image, context);\n}\n\nasync function domToBlob(node, options) {\n  const context = await orCreateContext(node, options);\n  const { log, type, quality, dpi } = context;\n  const canvas = await domToCanvas(context);\n  log.time(\"canvas to blob\");\n  const blob = await canvasToBlob(canvas, type, quality);\n  if ([\"image/png\", \"image/jpeg\"].includes(type) && dpi) {\n    const arrayBuffer = await blobToArrayBuffer(blob.slice(0, 33));\n    let uint8Array = new Uint8Array(arrayBuffer);\n    if (type === \"image/png\") {\n      uint8Array = changePngDpi(uint8Array, dpi);\n    } else if (type === \"image/jpeg\") {\n      uint8Array = changeJpegDpi(uint8Array, dpi);\n    }\n    log.timeEnd(\"canvas to blob\");\n    return new Blob([uint8Array, blob.slice(33)], { type });\n  }\n  log.timeEnd(\"canvas to blob\");\n  return blob;\n}\n\nasync function domToDataUrl(node, options) {\n  const context = await orCreateContext(node, options);\n  const { log, quality, type, dpi } = context;\n  const canvas = await domToCanvas(context);\n  log.time(\"canvas to data url\");\n  let dataUrl = canvas.toDataURL(type, quality);\n  if ([\"image/png\", \"image/jpeg\"].includes(type) && dpi && SUPPORT_ATOB && SUPPORT_BTOA) {\n    const [format, body] = dataUrl.split(\",\");\n    let headerLength = 0;\n    let overwritepHYs = false;\n    if (type === \"image/png\") {\n      const b64Index = detectPhysChunkFromDataUrl(body);\n      if (b64Index >= 0) {\n        headerLength = Math.ceil((b64Index + 28) / 3) * 4;\n        overwritepHYs = true;\n      } else {\n        headerLength = 33 / 3 * 4;\n      }\n    } else if (type === \"image/jpeg\") {\n      headerLength = 18 / 3 * 4;\n    }\n    const stringHeader = body.substring(0, headerLength);\n    const restOfData = body.substring(headerLength);\n    const headerBytes = window.atob(stringHeader);\n    const uint8Array = new Uint8Array(headerBytes.length);\n    for (let i = 0; i < uint8Array.length; i++) {\n      uint8Array[i] = headerBytes.charCodeAt(i);\n    }\n    const finalArray = type === \"image/png\" ? changePngDpi(uint8Array, dpi, overwritepHYs) : changeJpegDpi(uint8Array, dpi);\n    const base64Header = window.btoa(String.fromCharCode(...finalArray));\n    dataUrl = [format, \",\", base64Header, restOfData].join(\"\");\n  }\n  log.timeEnd(\"canvas to data url\");\n  return dataUrl;\n}\n\nasync function domToSvg(node, options) {\n  const context = await orCreateContext(node, options);\n  const { width, height, ownerDocument } = context;\n  const dataUrl = await domToDataUrl(context);\n  const svg = createSvg(width, height, ownerDocument);\n  const svgImage = svg.ownerDocument.createElementNS(svg.namespaceURI, \"image\");\n  svgImage.setAttributeNS(null, \"href\", dataUrl);\n  svgImage.setAttributeNS(null, \"height\", \"100%\");\n  svgImage.setAttributeNS(null, \"width\", \"100%\");\n  svg.appendChild(svgImage);\n  return svgToDataUrl(svg, context.isEnable(\"removeControlCharacter\"));\n}\n\nasync function domToImage(node, options) {\n  const context = await orCreateContext(node, options);\n  const { ownerDocument, width, height, scale, type } = context;\n  const url = type === \"image/svg+xml\" ? await domToSvg(context) : await domToDataUrl(context);\n  const image = createImage(url, ownerDocument);\n  image.width = Math.floor(width * scale);\n  image.height = Math.floor(height * scale);\n  image.style.width = `${width}px`;\n  image.style.height = `${height}px`;\n  return image;\n}\n\nasync function domToJpeg(node, options) {\n  return domToDataUrl(\n    await orCreateContext(node, { ...options, type: \"image/jpeg\" })\n  );\n}\n\nasync function domToPixel(node, options) {\n  const context = await orCreateContext(node, options);\n  const canvas = await domToCanvas(context);\n  return canvas.getContext(\"2d\").getImageData(0, 0, canvas.width, canvas.height).data;\n}\n\nasync function domToPng(node, options) {\n  return domToDataUrl(\n    await orCreateContext(node, { ...options, type: \"image/png\" })\n  );\n}\n\nasync function domToWebp(node, options) {\n  return domToDataUrl(\n    await orCreateContext(node, { ...options, type: \"image/webp\" })\n  );\n}\n\nexport { createContext, destroyContext, domToBlob, domToCanvas, domToDataUrl, domToForeignObjectSvg, domToImage, domToJpeg, domToPixel, domToPng, domToSvg, domToWebp, loadMedia, waitUntilLoad };\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport DiscussionControls from 'flarum/forum/utils/DiscussionControls';\nimport PostControls from 'flarum/forum/utils/PostControls';\nimport Button from 'flarum/common/components/Button';\nimport {domToJpeg } from 'modern-screenshot'\n\napp.initializers.add('tohsakarat-postCamera', () => {\n  function trimUrl(url) {\n    // 分割 URL 以'/d/'为界\n                var parts = url.split('/d/');\n              \n                // 检查是否正确分割成两部分\n                if (parts.length === 2) {\n                  // 分割第二部分以'-'为界，以获取第一个'-'之前的所有内容\n                  var subParts = parts[1].split('-');\n              \n                  // 检查是否正确分割\n                  if (subParts.length > 1) { \n                    // 重建 URL，只包括'/d/'之前的部分和第一个'-'之前的部分\n                    return parts[0] + '/d/' + subParts[0];\n                  }\n                }\n              \n                // 如果原始URL不符合预期的格式，返回未修改的URL\n                return url;\n          }\n\n    window.canSave=true;\n \n  //拓展发帖界面\n  extend(PostControls, 'userControls', function (items, post) {\n    const postUrl = app.forum.attribute('baseUrl') + app.route.post(post);\n\n    items.add(\n      'screen-shot',\n      Button.component(\n        {         \n          disable: (!canSave),\n          icon: 'fas fa-camera',\n          class: canSave? '':\"disabled\",\n          \n          onclick: () => {\n              if(!canSave){\n                m.redraw();\n                return;}\n              \n            window.cameraCurProgress='⏳⏳⏳';\n            window.canSave=false;\n            console.log('======保存截图======')\n            console.log(this);\n            var node=document.querySelector( '.PostStream-item[data-id=\"'+ post.data.id+'\"] ')\n            \n            var box = document.createElement('div');\n            box.className='temp-screenShot-box'\n            \n            var outerBox = document.createElement('div');\n            outerBox.className='temp-screenShot-outer-box'\n            \n            var node1=node.cloneNode(true)\n            node1.className+=' temp-screenShot'\n            \n            // 创建第一个 div 元素并设置类名 'coverAll'\n            var firstDiv = document.createElement('div');\n            firstDiv.className = 'coverAll coverPaper';\n            \n\n\n            // 创建第一个信息标签\n            var infoDiv = document.createElement('div');\n            infoDiv.className = 'temp-screenShot-info';\n            infoDiv.innerHTML= \"<b class='from'> 👉  </b>\"+trimUrl(postUrl) +\" \"+app.forum.data.attributes.title+\"<br / >\"+ (app?.session?.user?.data?.morseCode?app?.session?.user?.data?.morseCode:'');\n            \n           //box.appendChild(firstDiv);\n           \n            box.appendChild( infoDiv )\n            box.appendChild( node1 )\n            outerBox.appendChild(box)\n            node.appendChild(outerBox)\n            box.querySelectorAll(\"img[loading='lazy']\").forEach((img)=>{\n              img.removeAttribute('loading')\n              img.removeAttribute('importance')\n            })\n            \n            let list = box.querySelectorAll('.Dropdown-menu,.Reactions--Ul,.CommentPost--Reactions');\n            for(let i =0; i< list.length; ++i){\n               list[i].parentNode.removeChild(list[i]);\n            }\n            \n\n            setTimeout(() => {\n               domToJpeg(box,{\n                  quality:0.8,\n                  scale:2,\n                  debug: true,\n                  workerNumber :16 ,\n                  timeout:3000,\n                  progress: (current, total) => {\n                    window.canSave=false;\n                    m.redraw();\n                    console.log(`${ current }/${ total }`)\n                    window.cameraCurProgress=`${ current }/${ total }`\n                  },\n                  features:  {\n                      fixSvgXmlDecode:true\n                  }\n                }).then(dataUrl => {\n              const link = document.createElement('a')\n              link.download = \"screenShot\"+app.forum.data.attributes.title+ app.route.post(post)+'.jpeg'\n              link.href = dataUrl\n              link.click()\n              window.canSave=true;\n              m.redraw();\n              node.removeChild(outerBox)\n            })\n\n            },100)\n\n            \n          },\n        },\n        window.canSave ?  app.translator.trans('tohsakarat-post-camera.lib.scan-post'): window.cameraCurProgress\n      )\n    );\n  \n  });\n\n  \n  //拓展整个帖子\n  extend(DiscussionControls, 'userControls', function (items, discussion) {\n    const discussionUrl = app.forum.attribute('baseUrl') + app.route.discussion(discussion);\n    ;\n  \n    items.add(\n      'screen-shot',\n      Button.component(\n        {\n          disable: (!canSave),\n          icon: 'fas fa-camera',\n          class: canSave? '':\"disabled\",\n          \n          onclick: () => {\n            if(!canSave){\n              m.redraw();\n              return;}\n            window.cameraCurProgress='⏳⏳⏳';\n            window.canSave=false;\n            console.log('======保存截图======')\n            console.log(this);\n            var node=document.querySelector( '.DiscussionPage-discussion')\n            \n            var box = document.createElement('div');\n            box.className='temp-screenShot-box'\n            \n            var outerBox = document.createElement('div');\n            outerBox.className='temp-screenShot-outer-box'\n            \n            var node1=node.cloneNode(true)\n            node1.className+=' temp-screenShot'\n            \n            // 创建第一个 div 元素并设置类名 'coverAll'\n            var firstDiv = document.createElement('div');\n            firstDiv.className = 'coverAll';\n            \n\n\n            // 创建第一个信息标签\n            var infoDiv = document.createElement('div');\n            infoDiv.className = 'temp-screenShot-info';\n            infoDiv.innerHTML= \"<b class='from'> 👉  </b>\"+trimUrl(discussionUrl) +\" \"+app.forum.data.attributes.title+\"<br / >\"+ (app?.session?.user?.data?.morseCode?app?.session?.user?.data?.morseCode:'');\n           box.appendChild(firstDiv);\n           \n            box.appendChild( infoDiv )\n            box.appendChild( node1 )\n            outerBox.appendChild(box)\n            node.appendChild(outerBox)\n            box.querySelectorAll(\"img[loading='lazy']\").forEach((img)=>{\n              img.removeAttribute('loading')\n              img.removeAttribute('importance')\n            })\n            let list = box.querySelectorAll('.Dropdown-menu,.Reactions--Ul,.CommentPost--Reactions');\n            for(let i =0; i< list.length; ++i){\n               list[i].parentNode.removeChild(list[i]);\n            }\n            \n            setTimeout(() => {\n               domToJpeg(box,{\n                  quality:0.8,\n                  scale:2,\n                  debug: true,\n                  workerNumber :16 ,\n                  timeout:3000,\n                  progress: (current, total) => {\n                    window.canSave=false;\n                    m.redraw();\n                    console.log(`${ current }/${ total }`)\n                    window.cameraCurProgress=`${ current }/${ total }`\n                  },\n                  features:  {\n                      fixSvgXmlDecode:true\n                  }\n                }).then(dataUrl => {\n              const link = document.createElement('a')\n              link.download = \"screenShot\"+app.forum.data.attributes.title+'.jpeg'\n              link.href = dataUrl\n              link.click()\n              window.canSave=true;\n              m.redraw();\n            node.removeChild(outerBox)\n            })\n            }, 100);\n\n            \n          },\n        },\n        window.canSave ?  app.translator.trans('tohsakarat-post-camera.lib.scan-post'): window.cameraCurProgress\n      )\n    );\n  \n  });\n\n  \n});\n\n\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_P","charCodeAt","_H","_Y","_S","pngDataTable","changePngDpi","uint8Array","dpi","overwritepHYs","physChunk","Uint8Array","crc","c","crcTable","Int32Array","n","k","createPngDataTable","length","calcCrc","crcChunk","startingIndex","i","searchStartOfPhys","set","chunkLength","finalHeader","b64PhysSignature1","b64PhysSignature2","b64PhysSignature3","PREFIX","IN_BROWSER","window","SUPPORT_WEB_WORKER","SUPPORT_ATOB","SUPPORT_BTOA","USER_AGENT","navigator","userAgent","IN_CHROME","includes","IN_SAFARI","IN_FIREFOX","isContext","isCssFontFaceRule","rule","constructor","name","isCSSImportRule","isElementNode","node","nodeType","isSVGElementNode","className","isSVGImageElementNode","tagName","isSVGUseElementNode","isHTMLElementNode","style","isCommentNode","isTextNode","isImageElement","isVideoElement","isCanvasElement","isTextareaElement","isInputElement","isStyleElement","isScriptElement","isSelectElement","isSlotElement","isIFrameElement","consoleWarn","args","console","warn","supportWebp","ownerDocument","canvas","createElement","height","width","Boolean","toDataURL","isDataUrl","url","startsWith","resolveUrl","baseUrl","match","location","protocol","doc","getDocument","implementation","createHTMLDocument","base","head","appendChild","body","href","target","document","XMLNS","blobToDataUrl","blob","type","Promise","resolve","reject","reader","FileReader","onload","result","onerror","error","onabort","Error","readAsDataURL","readAsArrayBuffer","readBlob","createImage","img","decoding","loading","src","loadMedia","media","options","timeout","onError","userOnError","onWarn","timer","removeEventListeners","onResolve","clearTimeout","setTimeout","currentSrc","poster","then","readyState","onLoadeddata","removeEventListener","addEventListener","once","baseVal","onLoad","async","decode","dataset","originalSrc","complete","uuid","counter","Math","random","toString","slice","splitFontFamily","fontFamily","split","map","val","trim","replace","toLowerCase","filter","createLogger","debug","time","label","timeEnd","orCreateContext","scale","workerUrl","workerNumber","features","ownerWindow","defaultView","requests","Map","context","quality","backgroundColor","maximumCanvasSize","progress","fetch","requestInit","bypassingCache","cache","placeholderImage","fetchFn","font","drawImageInterval","onCloneNode","onEmbedNode","onCreateForeignObjectSvg","includeStyleProperties","autoDestruct","__CONTEXT__","log","svgStyleElement","createStyleElement","svgDefsElement","createElementNS","svgStyles","defaultComputedStyles","workers","Array","from","worker","Worker","onmessage","event","data","onmessageerror","fontFamilies","fontCssTexts","acceptOfImage","join","drawImageCount","tasks","isEnable","all","flatMap","selectors","querySelectorAll","el","waitUntilLoad","box","getBoundingClientRect","Number","getAttribute","resolveBoundingBox","createContext","cssText","createTextNode","cloneCanvas","dataURL","cloned","cloneNode","ctx","getContext","clonedCtx","putImageData","getImageData","ignoredStyles","includedAttributes","getDefaultStyle","pseudoElement","nodeName","isSvgNode","attributes","has","sandbox","id","visibility","position","contentWindow","write","getSandBox","sandboxWindow","sandboxDocument","root","namespaceURI","forEach","setAttributeNS","textContent","computedStyle","getComputedStyle","styles","len","item","getPropertyValue","removeChild","getDiffStyle","defaultStyle","diffStyle","prefixs","prefixTree","applyTo","priority","getPropertyPriority","subIndex","lastIndexOf","prefix","substring","push","pseudoClasses","scrollbarPseudoClasses","excludeParentNodes","Set","appendChildNode","child","addWordToFontFamilies","currentParentNodeStyle","currentNodeStyle","childCloned","chlidCloned","scrollTop","scrollLeft","transform","matrix","DOMMatrix","b","translateSelf","restoreScrollPosition","cloneChildNodes","shadowRoot","firstChild","nextSibling","assignedNodes","nodes","NORMAL_ATTRIBUTE_RE","isRoot","test","cloned2","iframe","contentDocument","cloneIframe","image","srcset","cloneImage","video","crossOrigin","canPlay","currentTime","offsetWidth","offsetHeight","drawImage","cloneVideo","cloneElement","names","getAttributeNames","removeAttribute","clonedStyle","_","delete","classList","add","scrollWidth","clientWidth","setProperty","copyCssStyles","applyCssStyleWithOptions","copyScrollbar","overflow","scrollHeight","clientHeight","textTransform","families","addWordToFontFamilies2","word","toUpperCase","family","text","copyBy","pseudoClass","content","klasses","cloneStyle","err","allClasses","copyPseudoClass","innerHTML","setAttribute","copyInputValue","contextFetch","rawUrl","requestType","responseType","imageDom","request","RegExp","Date","getTime","canFontMinify","minify","fontTexts","needFontMinify","size","baseFetchOptions","headers","accept","response","postMessage","controller","AbortController","abort","signal","ok","cause","arrayBuffer","finally","baseFetch","catch","replaceCssUrlToDataUrl","isImage","hasCssUrl","URL_RE","raw","quotation","parseCssUrls","dataUrl","toRE","escaped","properties","embedNode","embedImageElement","svgUrl","query","querySelector","svgData","insertAdjacentHTML","embedSvgUse","property","newValue","embedCssStyleImage","childNodes","COMMENTS_RE","KEYFRAMES_RE","URL_WITH_FORMAT_RE","FONT_SRC_RE","filterPreferredFormat","str","preferredFormat","format","exec","domToForeignObjectSvg","clone","allCssText","styleSheets","styleSheet","cssRules","cssRule","index","importIndex","replacedCssText","source","matches","IMPORT_RE","UNIFIED_RE","lastIndex","parseCss","insertRule","some","parentStyleSheet","cssText2","embedWebFont","count","current","task","pop","svg","createSvg","foreignObject","append","createForeignObjectSvg","insertBefore","children","clear","remove","destroyContext","domToCanvas","removeControlCharacter","xhtml","XMLSerializer","serializeToString","encodeURIComponent","svgToDataUrl","loaded","context2d","max","floor","fillStyle","fillRect","createCanvas","imageToCanvas","domToJpeg","headerLength","b64Index","b64index","indexOf","detectPhysChunkFromDataUrl","ceil","stringHeader","restOfData","headerBytes","atob","finalArray","changeJpegDpi","btoa","String","fromCharCode","domToDataUrl","app","trimUrl","parts","subParts","canSave","extend","PostControls","items","post","_this","postUrl","attribute","Button","disable","icon","class","onclick","_app$session","_app$session2","cameraCurProgress","outerBox","node1","infoDiv","title","user","morseCode","list","parentNode","total","m","redraw","fixSvgXmlDecode","link","download","click","trans","DiscussionControls","discussion","_this2","discussionUrl","_app$session3","_app$session4","firstDiv"],"sourceRoot":""}