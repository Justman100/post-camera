(()=>{var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t);const n=flarum.core.compat["forum/app"];var r=e.n(n);const o=flarum.core.compat["common/extend"],l=flarum.core.compat["forum/utils/DiscussionControls"];var i=e.n(l);const a=flarum.core.compat["forum/utils/PostControls"];var s=e.n(a);const c=flarum.core.compat["common/components/Button"];var u=e.n(c),d=Object.defineProperty,f=Object.defineProperties,g=Object.getOwnPropertyDescriptors,h=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable,v=Math.pow,y=(e,t,n)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,b=(e,t)=>{for(var n in t||(t={}))p.call(t,n)&&y(e,n,t[n]);if(h)for(var n of h(t))w.call(t,n)&&y(e,n,t[n]);return e},S=(e,t)=>f(e,g(t)),E=(e,t)=>{var n={};for(var r in e)p.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&h)for(var r of h(e))t.indexOf(r)<0&&w.call(e,r)&&(n[r]=e[r]);return n},C=(e,t,n)=>new Promise(((r,o)=>{var l=e=>{try{a(n.next(e))}catch(e){o(e)}},i=e=>{try{a(n.throw(e))}catch(e){o(e)}},a=e=>e.done?r(e.value):Promise.resolve(e.value).then(l,i);a((n=n.apply(e,t)).next())}));const A="p".charCodeAt(0),x="H".charCodeAt(0),N="Y".charCodeAt(0),k="s".charCodeAt(0);let T;function D(e,t,n=!1){const r=new Uint8Array(13);t*=39.3701,r[0]=A,r[1]=x,r[2]=N,r[3]=k,r[4]=t>>>24,r[5]=t>>>16,r[6]=t>>>8,r[7]=255&t,r[8]=r[4],r[9]=r[5],r[10]=r[6],r[11]=r[7],r[12]=1;const o=function(e){let t=-1;T||(T=function(){const e=new Int32Array(256);for(let t=0;t<256;t++){let n=t;for(let e=0;e<8;e++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}());for(let n=0;n<e.length;n++)t=T[255&(t^e[n])]^t>>>8;return-1^t}(r),l=new Uint8Array(4);if(l[0]=o>>>24,l[1]=o>>>16,l[2]=o>>>8,l[3]=255&o,n){const t=function(e){for(let t=e.length-1;t>=4;t--)if(9===e[t-4]&&e[t-3]===A&&e[t-2]===x&&e[t-1]===N&&e[t]===k)return t-3;return 0}(e);return e.set(r,t),e.set(l,t+13),e}{const t=new Uint8Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=9;const n=new Uint8Array(54);return n.set(e,0),n.set(t,33),n.set(r,37),n.set(l,50),n}}const P="AAlwSFlz",$="AAAJcEhZ",F="AAAACXBI",I="[modern-screenshot]",_="undefined"!=typeof window,O=_&&"Worker"in window,M=_&&"atob"in window,j=_&&"btoa"in window;var L;const R=_?null==(L=window.navigator)?void 0:L.userAgent:"",U=R.includes("Chrome"),q=R.includes("AppleWebKit")&&!U,B=R.includes("Firefox"),W=e=>e&&"__CONTEXT__"in e,z=e=>"CSSFontFaceRule"===e.constructor.name,V=e=>"CSSImportRule"===e.constructor.name,H=e=>1===e.nodeType,X=e=>"object"==typeof e.className,Y=e=>"image"===e.tagName,G=e=>"use"===e.tagName,J=e=>H(e)&&void 0!==e.style&&!X(e),K=e=>8===e.nodeType,Q=e=>3===e.nodeType,Z=e=>"IMG"===e.tagName,ee=e=>"VIDEO"===e.tagName,te=e=>"CANVAS"===e.tagName,ne=e=>"TEXTAREA"===e.tagName,re=e=>"INPUT"===e.tagName,oe=e=>"STYLE"===e.tagName,le=e=>"SCRIPT"===e.tagName,ie=e=>"SELECT"===e.tagName,ae=e=>"SLOT"===e.tagName,se=e=>"IFRAME"===e.tagName,ce=(...e)=>console.warn(I,...e),ue=e=>console.time(`${I} ${e}`),de=e=>console.timeEnd(`${I} ${e}`),me=e=>{var t;const n=null==(t=null==e?void 0:e.createElement)?void 0:t.call(e,"canvas");return n&&(n.height=n.width=1),n&&"toDataURL"in n&&Boolean(n.toDataURL("image/webp").includes("image/webp"))},fe=e=>e.startsWith("data:");function ge(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(_&&e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i)||!_)return e;const n=he().implementation.createHTMLDocument(),r=n.createElement("base"),o=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(o),t&&(r.href=t),o.href=e,o.href}function he(e){var t;return null!=(t=e&&H(e)?null==e?void 0:e.ownerDocument:e)?t:window.document}const pe="http://www.w3.org/2000/svg";const we=e=>function(e,t){return new Promise(((n,r)=>{const o=new FileReader;o.onload=()=>n(o.result),o.onerror=()=>r(o.error),o.onabort=()=>r(new Error(`Failed read blob to ${t}`)),"dataUrl"===t?o.readAsDataURL(e):"arrayBuffer"===t&&o.readAsArrayBuffer(e)}))}(e,"dataUrl");function ve(e,t){const n=he(t).createElement("img");return n.decoding="sync",n.loading="eager",n.src=e,n}function ye(e,t){return new Promise((n=>{const{timeout:r,ownerDocument:o,onError:l}=null!=t?t:{},i="string"==typeof e?ve(e,he(o)):e;let a=null,s=null;function c(){n(i),a&&clearTimeout(a),null==s||s()}if(r&&(a=setTimeout(c,r)),ee(i)){const e=i.currentSrc||i.src;if(!e)return i.poster?ye(i.poster,t).then(n):c();if(i.readyState>=2)return c();const r=c,o=t=>{ce("Failed video load",e,t),null==l||l(t),c()};s=()=>{i.removeEventListener("loadeddata",r),i.removeEventListener("error",o)},i.addEventListener("loadeddata",r,{once:!0}),i.addEventListener("error",o,{once:!0})}else{const e=Y(i)?i.href.baseVal:i.currentSrc||i.src;if(!e)return c();const t=()=>C(this,null,(function*(){if(Z(i)&&"decode"in i)try{yield i.decode()}catch(t){ce("Failed to decode image, trying to render anyway",i.dataset.originalSrc||e,t)}c()})),n=t=>{ce("Failed image load",i.dataset.originalSrc||e,t),c()};if(Z(i)&&i.complete)return t();s=()=>{i.removeEventListener("load",t),i.removeEventListener("error",n)},i.addEventListener("load",t,{once:!0}),i.addEventListener("error",n,{once:!0})}}))}const be=function(){let e=0;return()=>(e+=1,`u${`0000${(Math.random()*v(36,4)<<0).toString(36)}`.slice(-4)}${e}`)}();function Se(e){return null==e?void 0:e.split(",").map((e=>e.trim().replace(/"|'/g,"").toLowerCase())).filter(Boolean)}function Ee(e){return{time:t=>e&&ue(t),timeEnd:t=>e&&de(t),warn:(...t)=>e&&ce(...t)}}function Ce(e){return{cache:e?"no-cache":"force-cache"}}function Ae(e,t){return C(this,null,(function*(){return W(e)?e:function(e,t){return C(this,null,(function*(){var n,r,o,l,i;const{scale:a=1,workerUrl:s,workerNumber:c=1}=t||{},u=Boolean(null==t?void 0:t.debug),d=null==(n=null==t?void 0:t.features)||n,m=null!=(r=e.ownerDocument)?r:_?window.document:void 0,f=null!=(l=null==(o=e.ownerDocument)?void 0:o.defaultView)?l:_?window:void 0,g=new Map,h=S(b({width:0,height:0,quality:1,type:"image/png",scale:a,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:u,fetch:b({requestInit:Ce(null==(i=null==t?void 0:t.fetch)?void 0:i.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1},null==t?void 0:t.fetch),fetchFn:null,font:{},drawImageInterval:100,workerUrl:null,workerNumber:c,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,includeStyleProperties:null,autoDestruct:!1},t),{__CONTEXT__:!0,log:Ee(u),node:e,ownerDocument:m,ownerWindow:f,dpi:1===a?null:96*a,svgStyleElement:xe(m),svgDefsElement:null==m?void 0:m.createElementNS(pe,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...new Array(O&&s&&c?c:0)].map((()=>{try{const e=new Worker(s);return e.onmessage=e=>C(this,null,(function*(){var t,n,r,o;const{url:l,result:i}=e.data;i?null==(n=null==(t=g.get(l))?void 0:t.resolve)||n.call(t,i):null==(o=null==(r=g.get(l))?void 0:r.reject)||o.call(r,new Error(`Error receiving message from worker: ${l}`))})),e.onmessageerror=e=>{var t,n;const{url:r}=e.data;null==(n=null==(t=g.get(r))?void 0:t.reject)||n.call(t,new Error(`Error receiving message from worker: ${r}`))},e}catch(e){return ce("Failed to new Worker",e),null}})).filter(Boolean),fontFamilies:new Set,fontCssTexts:new Map,acceptOfImage:`${[me(m)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:g,drawImageCount:0,tasks:[],features:d,isEnable:e=>{var t;return"boolean"==typeof d?d:null==(t=d[e])||t}});h.log.time("wait until load"),yield function(e,t){return C(this,null,(function*(){J(e)&&(Z(e)||ee(e)?yield ye(e,{timeout:t}):yield Promise.all(["img","video"].flatMap((n=>Array.from(e.querySelectorAll(n)).map((e=>ye(e,{timeout:t})))))))}))}(e,h.timeout),h.log.timeEnd("wait until load");const{width:p,height:w}=function(e,t){let{width:n,height:r}=t;if(H(e)&&(!n||!r)){const t=e.getBoundingClientRect();n=n||t.width||Number(e.getAttribute("width"))||0,r=r||t.height||Number(e.getAttribute("height"))||0}return{width:n,height:r}}(e,h);return h.width=p,h.height=w,h}))}(e,S(b({},t),{autoDestruct:!0}))}))}function xe(e){if(!e)return;const t=e.createElement("style"),n=t.ownerDocument.createTextNode("\n.______background-clip--text {\n  background-clip: text;\n  -webkit-background-clip: text;\n}\n");return t.appendChild(n),t}const Ne=["width","height","-webkit-text-fill-color"],ke=["stroke","fill"];function Te(e,t,n){var r;const{defaultComputedStyles:o,ownerDocument:l}=n,i=e.nodeName.toLowerCase(),a=X(e)&&"svg"!==i,s=a?ke.map((t=>[t,e.getAttribute(t)])).filter((([,e])=>null!==e)):[],c=[a&&"svg",i,s.map(((e,t)=>`${e}=${t}`)).join(","),t].filter(Boolean).join(":");if(o.has(c))return o.get(c);let u=n.sandbox;if(!u)try{l&&(u=l.createElement("iframe"),u.id=`__SANDBOX__-${be()}`,u.width="0",u.height="0",u.style.visibility="hidden",u.style.position="fixed",l.body.appendChild(u),null==(r=u.contentWindow)||r.document.write('<!DOCTYPE html><meta charset="UTF-8"><title></title><body>'),n.sandbox=u)}catch(e){ce("Failed to create iframe sandbox",e)}if(!u)return new Map;const d=u.contentWindow;if(!d)return new Map;const m=d.document;let f,g;a?(f=m.createElementNS(pe,"svg"),g=f.ownerDocument.createElementNS(f.namespaceURI,i),s.forEach((([e,t])=>{g.setAttributeNS(null,e,t)})),f.appendChild(g)):f=g=m.createElement(i),g.textContent=" ",m.body.appendChild(f);const h=d.getComputedStyle(g,t),p=new Map;for(let e=h.length,t=0;t<e;t++){const e=h.item(t);Ne.includes(e)||p.set(e,h.getPropertyValue(e))}return m.body.removeChild(f),o.set(c,p),p}function De(e,t,n){var r;const o=new Map,l=[],i=new Map;if(n)for(const e of n)a(e);else for(let t=e.length,n=0;n<t;n++)a(e.item(n));for(let e=l.length,t=0;t<e;t++)null==(r=i.get(l[t]))||r.forEach(((e,t)=>o.set(t,e)));function a(n){const r=e.getPropertyValue(n),a=e.getPropertyPriority(n),s=n.lastIndexOf("-"),c=s>-1?n.substring(0,s):void 0;if(c){let e=i.get(c);e||(e=new Map,i.set(c,e)),e.set(n,[r,a])}t.get(n)===r&&!a||(c?l.push(c):o.set(n,[r,a]))}return o}const Pe=[":before",":after"],$e=[":-webkit-scrollbar",":-webkit-scrollbar-button",":-webkit-scrollbar-thumb",":-webkit-scrollbar-track",":-webkit-scrollbar-track-piece",":-webkit-scrollbar-corner",":-webkit-resizer"];function Fe(e){if(e.ownerDocument)try{const t=e.toDataURL();if("data:,"!==t)return ve(t,e.ownerDocument)}catch(e){}const t=e.cloneNode(!1),n=e.getContext("2d"),r=t.getContext("2d");try{return n&&r&&r.putImageData(n.getImageData(0,0,e.width,e.height),0,0),t}catch(e){ce("Failed to clone canvas",e)}return t}const Ie=new Set(["symbol"]);function _e(e,t,n){return C(this,null,(function*(){H(t)&&(oe(t)||le(t))||n.filter&&!n.filter(t)||(Ie.has(e.nodeName)||Ie.has(t.nodeName)?n.currentParentNodeStyle=void 0:n.currentParentNodeStyle=n.currentNodeStyle,e.appendChild(yield je(t,n)))}))}function Oe(e,t,n){return C(this,null,(function*(){var r,o;for(let l=null!=(o=H(e)?null==(r=e.shadowRoot)?void 0:r.firstChild:void 0)?o:e.firstChild;l;l=l.nextSibling)if(!K(l))if(H(l)&&ae(l)&&"function"==typeof l.assignedNodes){const e=l.assignedNodes();for(let r=0;r<e.length;r++)yield _e(t,e[r],n)}else yield _e(t,l,n)}))}const Me=/^[\w-:]+$/;function je(e,t,n=!1){return C(this,null,(function*(){var r,o,l,i;const{ownerDocument:a,ownerWindow:s,fontFamilies:c}=t;if(a&&Q(e))return a.createTextNode(e.data);if(a&&s&&H(e)&&(J(e)||X(e))){const a=yield function(e,t){return te(e)?Fe(e):se(e)?function(e,t){var n;try{if(null!=(n=null==e?void 0:e.contentDocument)&&n.body)return je(e.contentDocument.body,t)}catch(e){ce("Failed to clone iframe",e)}return e.cloneNode(!1)}(e,t):Z(e)?function(e){const t=e.cloneNode(!1);return e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager"),t}(e):ee(e)?function(e){return C(this,null,(function*(){if(e.ownerDocument&&!e.currentSrc&&e.poster)return ve(e.poster,e.ownerDocument);const t=e.cloneNode(!1);t.crossOrigin="anonymous",e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc);const n=t.ownerDocument;if(n){let r=!0;if(yield ye(t,{onError:()=>r=!1}),!r)return e.poster?ve(e.poster,e.ownerDocument):t;t.currentTime=e.currentTime,yield new Promise((e=>{t.addEventListener("seeked",e,{once:!0})}));const o=n.createElement("canvas");o.width=e.offsetWidth,o.height=e.offsetHeight;try{const e=o.getContext("2d");e&&e.drawImage(t,0,0,o.width,o.height)}catch(n){return ce("Failed to clone video",n),e.poster?ve(e.poster,e.ownerDocument):t}return Fe(o)}return t}))}(e):e.cloneNode(!1)}(e,t);if(t.isEnable("removeAbnormalAttributes")){const e=a.getAttributeNames();for(let t=e.length,n=0;n<t;n++){const t=e[n];Me.test(t)||a.removeAttribute(t)}}const s=t.currentNodeStyle=function(e,t,n,r){var o,l,i,a;const{ownerWindow:s,includeStyleProperties:c,currentParentNodeStyle:u}=r,d=t.style,m=s.getComputedStyle(e),f=Te(e,null,r);null==u||u.forEach(((e,t)=>{f.delete(t)}));const g=De(m,f,c);return g.delete("transition-property"),g.delete("all"),g.delete("d"),g.delete("content"),n&&(g.delete("margin-top"),g.delete("margin-right"),g.delete("margin-bottom"),g.delete("margin-left"),g.delete("margin-block-start"),g.delete("margin-block-end"),g.delete("margin-inline-start"),g.delete("margin-inline-end"),g.set("box-sizing",["border-box",""])),"text"===(null==(o=g.get("background-clip"))?void 0:o[0])&&t.classList.add("______background-clip--text"),U&&(g.has("font-kerning")||g.set("font-kerning",["normal",""]),("hidden"===(null==(l=g.get("overflow-x"))?void 0:l[0])||"hidden"===(null==(i=g.get("overflow-y"))?void 0:i[0]))&&"ellipsis"===(null==(a=g.get("text-overflow"))?void 0:a[0])&&e.scrollWidth===e.clientWidth&&g.set("text-overflow",["clip",""])),g.forEach((([e,t],n)=>{d.setProperty(n,e,t)})),g}(e,a,n,t);n&&function(e,t){const{backgroundColor:n,width:r,height:o,style:l}=t,i=e.style;if(n&&i.setProperty("background-color",n,"important"),r&&i.setProperty("width",`${r}px`,"important"),o&&i.setProperty("height",`${o}px`,"important"),l)for(const e in l)i[e]=l[e]}(a,t);let u=!1;if(t.isEnable("copyScrollbar")){const t=[null==(r=s.get("overflow-x"))?void 0:r[0],null==(o=s.get("overflow-y"))?void 0:o[1]];u=t.includes("scroll")||(t.includes("auto")||t.includes("overlay"))&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)}return function(e,t,n,r){const{ownerWindow:o,svgStyleElement:l,svgStyles:i,currentNodeStyle:a}=r;function s(n){var l;const s=o.getComputedStyle(e,n);let c=s.getPropertyValue("content");if(!c||"none"===c)return;c=c.replace(/(')|(")|(counter\(.+\))/g,"");const u=[be()],d=Te(e,n,r);null==a||a.forEach(((e,t)=>{d.delete(t)}));const m=De(s,d,r.includeStyleProperties);m.delete("content"),m.delete("-webkit-locale"),"text"===(null==(l=m.get("background-clip"))?void 0:l[0])&&t.classList.add("______background-clip--text");const f=[`content: '${c}';`];if(m.forEach((([e,t],n)=>{f.push(`${n}: ${e}${t?" !important":""};`)})),1===f.length)return;try{t.className=[t.className,...u].join(" ")}catch(e){return}const g=f.join("\n  ");let h=i.get(g);h||(h=[],i.set(g,h)),h.push(`.${u[0]}:${n}`)}l&&o&&(Pe.forEach(s),n&&$e.forEach(s))}(e,a,u,t),function(e,t){ne(e)&&(t.innerHTML=e.value),(ne(e)||re(e)||ie(e))&&t.setAttribute("value",e.value)}(e,a),null==(i=Se(null==(l=s.get("font-family"))?void 0:l[0]))||i.forEach((e=>c.add(e))),ee(e)||(yield Oe(e,a,t)),a}const u=e.cloneNode(!1);return yield Oe(e,u,t),u}))}function Le(e,t){const{url:n,requestType:r="text",responseType:o="text",imageDom:l}=t;let i=n;const{timeout:a,acceptOfImage:s,requests:c,fetchFn:u,fetch:{requestInit:d,bypassingCache:m,placeholderImage:f},workers:g}=e;"image"===r&&(q||B)&&e.drawImageCount++;let h=c.get(n);if(!h){m&&m instanceof RegExp&&m.test(i)&&(i+=(/\?/.test(i)?"&":"?")+(new Date).getTime());const e=b({url:i,timeout:a,responseType:o,headers:"image"===r?{accept:s}:void 0},d);h={type:r,resolve:void 0,reject:void 0,response:null},h.response=(()=>C(this,null,(function*(){if(u&&"image"===r){const e=yield u(n);if(e)return e}return!q&&n.startsWith("http")&&g.length?new Promise(((t,r)=>{g[c.size&g.length-1].postMessage(b({rawUrl:n},e)),h.resolve=t,h.reject=r})):function(e){const t=e,{url:n,timeout:r,responseType:o}=t,l=E(t,["url","timeout","responseType"]),i=new AbortController,a=r?setTimeout((()=>i.abort()),r):void 0;return fetch(n,b({signal:i.signal},l)).then((e=>{if(!e.ok)throw new Error("Failed fetch, not 2xx response",{cause:e});return"dataUrl"===o?e.blob().then(we):e.text()})).finally((()=>clearTimeout(a)))}(e)})))().catch((e=>{if(c.delete(n),"image"===r&&f)return ce("Failed to fetch image base64, trying to use placeholder image",i),"string"==typeof f?f:f(l);throw e})),c.set(n,h)}return h.response}function Re(e,t,n,r){return C(this,null,(function*(){if(!Ue(e))return e;for(const[o,l]of function(e,t){const n=[];return e.replace(qe,((e,r,o)=>(n.push([o,ge(o,t)]),e))),n.filter((([e])=>!fe(e)))}(e,t))try{const t=yield Le(n,{url:l,requestType:r?"image":"text",responseType:"dataUrl"});e=e.replace(Be(o),`$1${t}$3`)}catch(e){ce("Failed to fetch css data url",o,e)}return e}))}function Ue(e){return/url\((['"]?)([^'"]+?)\1\)/.test(e)}const qe=/url\((['"]?)([^'"]+?)\1\)/g;function Be(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}const We=/(\/\*[\s\S]*?\*\/)/gi,ze=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi,Ve=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,He=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Xe(e,t){const{font:n}=t,r=n?null==n?void 0:n.preferredFormat:void 0;return r?e.replace(He,(e=>{for(;;){const[t,,n]=Ve.exec(e)||[];if(!n)return"";if(n===r)return`src: ${t};`}})):e}const Ye=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function Ge(e,t){const{tasks:n}=t;H(e)&&((Z(e)||Y(e))&&n.push(...function(e,t){if(Z(e)){const n=e.currentSrc||e.src;if(!fe(n))return[Le(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then((t=>{t&&(e.srcset="",e.dataset.originalSrc=n,e.src=t||"")}))];(q||B)&&t.drawImageCount++}else if(X(e)&&!fe(e.href.baseVal)){const n=e.href.baseVal;return[Le(t,{url:n,imageDom:e,requestType:"image",responseType:"dataUrl"}).then((t=>{t&&(e.dataset.originalSrc=n,e.href.baseVal=t||"")}))]}return[]}(e,t)),G(e)&&n.push(...function(e,t){var n;const{ownerDocument:r,svgDefsElement:o}=t,l=null!=(n=e.getAttribute("href"))?n:e.getAttribute("xlink:href");if(!l)return[];const[i,a]=l.split("#");if(a){const n=`#${a}`,l=null==r?void 0:r.querySelector(`svg ${n}`);if(i&&e.setAttribute("href",n),null!=o&&o.querySelector(n))return[];if(l)return[je(l,t).then((e=>{null!=o&&o.querySelector(n)||null==o||o.appendChild(e)}))];if(i)return[Le(t,{url:i,responseType:"text"}).then((e=>{null==o||o.insertAdjacentHTML("beforeend",e)}))]}return[]}(e,t))),J(e)&&n.push(...function(e,t){return Ye.map((n=>{const r=e.getPropertyValue(n);return r&&"none"!==r?((q||B)&&t.drawImageCount++,Re(r,null,t,!0).then((t=>{!t||r===t||e.setProperty(n,t,e.getPropertyPriority(n))}))):null})).filter(Boolean)}(e.style,t)),e.childNodes.forEach((e=>{Ge(e,t)}))}function Je(e,t){return C(this,null,(function*(){const n=yield Ae(e,t);if(H(n.node)&&X(n.node))return n.node;const{ownerDocument:r,log:o,tasks:l,svgStyleElement:i,svgDefsElement:a,svgStyles:s,font:c,progress:u,autoDestruct:d,onCloneNode:m,onEmbedNode:f,onCreateForeignObjectSvg:g}=n;o.time("clone node");const h=yield je(n.node,n,!0);if(i&&r){let e="";s.forEach(((t,n)=>{e+=`${t.join(",\n")} {\n  ${n}\n}\n`})),i.appendChild(r.createTextNode(e))}o.timeEnd("clone node"),null==m||m(h),!1!==c&&H(h)&&(o.time("embed web font"),yield function(e,t){return C(this,null,(function*(){const{ownerDocument:e,svgStyleElement:n,fontFamilies:r,fontCssTexts:o,tasks:l,font:i}=t;if(e&&n&&r.size)if(i&&i.cssText){const r=Xe(i.cssText,t);n.appendChild(e.createTextNode(`${r}\n`))}else{const i=Array.from(e.styleSheets).filter((e=>{try{return"cssRules"in e&&Boolean(e.cssRules.length)}catch(t){return ce(`Error while reading CSS rules from ${e.href}`,t),!1}}));yield Promise.all(i.flatMap((e=>Array.from(e.cssRules).map(((n,r)=>C(this,null,(function*(){if(V(n)){let o=r+1;const l=n.href;let i="";try{i=yield Le(t,{url:l,requestType:"text",responseType:"text"})}catch(e){ce(`Error fetch remote css import from ${l}`,e)}const a=i.replace(qe,((e,t,n)=>e.replace(n,ge(n,l))));for(const t of function(e){if(null==e)return[];const t=[];let n=e.replace(We,"");for(;;){const e=ze.exec(n);if(!e)break;t.push(e[0])}n=n.replace(ze,"");const r=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=r.exec(n);if(e)o.lastIndex=r.lastIndex;else{if(e=o.exec(n),!e)break;r.lastIndex=o.lastIndex}t.push(e[0])}return t}(a))try{e.insertRule(t,t.startsWith("@import")?o+=1:e.cssRules.length)}catch(e){ce("Error inserting rule from remote css import",{rule:t,error:e})}}}))))))),i.flatMap((e=>Array.from(e.cssRules))).filter((e=>{var t;return z(e)&&Ue(e.style.getPropertyValue("src"))&&(null==(t=Se(e.style.getPropertyValue("font-family")))?void 0:t.some((e=>r.has(e))))})).forEach((r=>{const i=r,a=o.get(i.cssText);a?n.appendChild(e.createTextNode(`${a}\n`)):l.push(Re(i.cssText,i.parentStyleSheet?i.parentStyleSheet.href:null,t).then((r=>{r=Xe(r,t),o.set(i.cssText,r),n.appendChild(e.createTextNode(`${r}\n`))})))}))}}))}(0,n),o.timeEnd("embed web font")),o.time("embed node"),Ge(h,n);const p=l.length;let w=0;null==u||u(w,p),yield Promise.all([...Array(4)].map((()=>C(this,null,(function*(){for(;;){const e=l.pop();if(!e)break;try{yield e}catch(e){ce("Failed to run task",e)}null==u||u(++w,p)}}))))),o.timeEnd("embed node"),null==f||f(h);const v=function(e,t){const{width:n,height:r}=t,o=function(e,t,n){const r=he(n).createElementNS(pe,"svg");return r.setAttributeNS(null,"width",e.toString()),r.setAttributeNS(null,"height",t.toString()),r.setAttributeNS(null,"viewBox",`0 0 ${e} ${t}`),r}(n,r,e.ownerDocument),l=o.ownerDocument.createElementNS(o.namespaceURI,"foreignObject");return l.setAttributeNS(null,"x","0%"),l.setAttributeNS(null,"y","0%"),l.setAttributeNS(null,"width","100%"),l.setAttributeNS(null,"height","100%"),l.append(e),o.appendChild(l),o}(h,n);return a&&v.insertBefore(a,v.children[0]),i&&v.insertBefore(i,v.children[0]),d&&function(e){if(e.ownerDocument=void 0,e.ownerWindow=void 0,e.svgStyleElement=void 0,e.svgDefsElement=void 0,e.svgStyles.clear(),e.defaultComputedStyles.clear(),e.sandbox){try{e.sandbox.remove()}catch(e){}e.sandbox=void 0}e.workers=[],e.fontFamilies.clear(),e.fontCssTexts.clear(),e.requests.clear(),e.tasks=[]}(n),null==g||g(v),v}))}function Ke(e,t){return C(this,null,(function*(){var n;const r=yield Ae(e,t),o=yield Je(r),l=function(e,t){let n=(new XMLSerializer).serializeToString(e);return t&&(n=n.replace(/[\u0000-\u0008\u000B\u000C\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/gu,"")),`data:image/svg+xml;charset=utf-8,${encodeURIComponent(n)}`}(o,r.isEnable("removeControlCharacter"));r.autoDestruct||(r.svgStyleElement=xe(r.ownerDocument),r.svgDefsElement=null==(n=r.ownerDocument)?void 0:n.createElementNS(pe,"defs"),r.svgStyles.clear());const i=ve(l,o.ownerDocument);return yield function(e,t){return C(this,null,(function*(){const{log:n,timeout:r,drawImageCount:o,drawImageInterval:l}=t;n.time("image to canvas");const i=yield ye(e,{timeout:r}),{canvas:a,context2d:s}=function(e,t){const{width:n,height:r,scale:o,backgroundColor:l,maximumCanvasSize:i}=t,a=e.createElement("canvas");a.width=Math.floor(n*o),a.height=Math.floor(r*o),a.style.width=`${n}px`,a.style.height=`${r}px`,i&&(a.width>i||a.height>i)&&(a.width>i&&a.height>i?a.width>a.height?(a.height*=i/a.width,a.width=i):(a.width*=i/a.height,a.height=i):a.width>i?(a.height*=i/a.width,a.width=i):(a.width*=i/a.height,a.height=i));const s=a.getContext("2d");return s&&l&&(s.fillStyle=l,s.fillRect(0,0,a.width,a.height)),{canvas:a,context2d:s}}(e.ownerDocument,t),c=()=>{try{null==s||s.drawImage(i,0,0,a.width,a.height)}catch(e){ce("Failed to drawImage",e)}};if(c(),t.isEnable("fixSvgXmlDecode"))for(let e=0;e<o;e++)yield new Promise((t=>{setTimeout((()=>{c(),t()}),e+l)}));return t.drawImageCount=0,n.timeEnd("image to canvas"),a}))}(i,r)}))}function Qe(e,t){return C(this,null,(function*(){return function(e,t){return C(this,null,(function*(){const n=yield Ae(e,t),{log:r,quality:o,type:l,dpi:i}=n,a=yield Ke(n);r.time("canvas to data url");let s=a.toDataURL(l,o);if(["image/png","image/jpeg"].includes(l)&&i&&M&&j){const[e,t]=s.split(",");let n=0,r=!1;if("image/png"===l){const e=function(e){let t=e.indexOf(P);return-1===t&&(t=e.indexOf($)),-1===t&&(t=e.indexOf(F)),t}(t);e>=0?(n=4*Math.ceil((e+28)/3),r=!0):n=44}else"image/jpeg"===l&&(n=24);const o=t.substring(0,n),a=t.substring(n),c=window.atob(o),u=new Uint8Array(c.length);for(let e=0;e<u.length;e++)u[e]=c.charCodeAt(e);const d="image/png"===l?D(u,i,r):function(e,t){return e[13]=1,e[14]=t>>8,e[15]=255&t,e[16]=t>>8,e[17]=255&t,e}(u,i);s=[e,",",window.btoa(String.fromCharCode(...d)),a].join("")}return r.timeEnd("canvas to data url"),s}))}(yield Ae(e,S(b({},t),{type:"image/png"})))}))}r().initializers.add("tohsakarat-postCamera",(function(){function e(e){var t=e.split("/d/");if(2===t.length){var n=t[1].split("-");if(n.length>1)return t[0]+"/d/"+n[0]}return e}window.canSave=!0,(0,o.extend)(s(),"userControls",(function(t,n){var o=this,l=r().forum.attribute("baseUrl")+r().route.post(n);t.add("screen-shot",u().component({disable:!canSave,icon:"fas fa-camera",class:canSave?"":"disabled",onclick:function(){var t;if(canSave){window.cameraCurProgress="⏳⏳⏳",window.canSave=!1,console.log("======保存截图======"),console.log(o);var i=document.querySelector('.PostStream-item[data-id="'+n.data.id+'"] '),a=document.createElement("div");a.className="temp-screenShot-box";var s=document.createElement("div");s.className="temp-screenShot-outer-box";var c=i.cloneNode(!0);c.className+=" temp-screenShot",document.createElement("div").className="coverAll";var u=document.createElement("div");u.className="temp-screenShot-info",u.innerHTML="<b class='from'> 👉  </b>"+e(l)+" "+r().forum.data.attributes.title+"<br / >"+(null==r()||null==(t=r().session)||null==(t=t.user)||null==(t=t.data)?void 0:t.morseCode),a.appendChild(u),a.appendChild(c),s.appendChild(a),i.appendChild(s),a.querySelectorAll("img[loading='lazy']").forEach((function(e){e.removeAttribute("loading"),e.removeAttribute("importance")})),setTimeout((function(){Qe(a,{quality:window.isPC?16:8,debug:!0,progress:function(e,t){window.canSave=!1,m.redraw(),console.log(e+"/"+t),window.cameraCurProgress=e+"/"+t}}).then((function(e){var t=document.createElement("a");t.download="screenShot"+r().forum.data.attributes.title+r().route.post(n)+".png",t.href=e,t.click(),window.canSave=!0,m.redraw(),i.removeChild(s)}))}),100)}else m.redraw()}},window.canSave?r().translator.trans("tohsakarat-post-camera.lib.scan-post"):window.cameraCurProgress))})),(0,o.extend)(i(),"userControls",(function(t,n){var o=this,l=r().forum.attribute("baseUrl")+r().route.discussion(n);t.add("screen-shot",u().component({disable:!canSave,icon:"fas fa-camera",class:canSave?"":"disabled",onclick:function(){var t;if(canSave){window.cameraCurProgress="⏳⏳⏳",window.canSave=!1,console.log("======保存截图======"),console.log(o);var n=document.querySelector(".DiscussionPage-discussion"),i=document.createElement("div");i.className="temp-screenShot-box";var a=document.createElement("div");a.className="temp-screenShot-outer-box";var s=n.cloneNode(!0);s.className+=" temp-screenShot",document.createElement("div").className="coverAll";var c=document.createElement("div");c.className="temp-screenShot-info",c.innerHTML="<b class='from'> 👉  </b>"+e(l)+" "+r().forum.data.attributes.title+"<br / >"+(null==r()||null==(t=r().session)||null==(t=t.user)||null==(t=t.data)?void 0:t.morseCode),i.appendChild(c),i.appendChild(s),a.appendChild(i),n.appendChild(a),i.querySelectorAll("img[loading='lazy']").forEach((function(e){e.removeAttribute("loading"),e.removeAttribute("importance")})),setTimeout((function(){Qe(i,{quality:window.isPC?8:4,debug:!0,progress:function(e,t){window.canSave=!1,m.redraw(),console.log(e+"/"+t),window.cameraCurProgress=e+"/"+t}}).then((function(e){var t=document.createElement("a");t.download="screenShot"+r().forum.data.attributes.title+".png",t.href=e,t.click(),window.canSave=!0,m.redraw(),n.removeChild(a)}))}),100)}else m.redraw()}},window.canSave?r().translator.trans("tohsakarat-post-camera.lib.scan-post"):window.cameraCurProgress))}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map